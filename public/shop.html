<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop - TillValle</title>
  <link rel="stylesheet" href="css/site.css">
  <link rel="stylesheet" href="css/navbar.css">
  <link rel="icon" href="logo.jpg" type="image/jpeg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <link rel="stylesheet" href="global-chat.css">
  <!-- Hotjar Tracking Code -->
  <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:5208839,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
  <script>
    // Cookie consent logic - store preferences in localStorage under 'tillvalle_cookie_consent'
    (function(){
      const KEY = 'tillvalle_cookie_consent';
      const banner = document.getElementById('cookie-consent');
      const modal = document.getElementById('cookie-modal');
      const acceptBtn = document.getElementById('cookie-accept');
      const declineBtn = document.getElementById('cookie-decline');
      const manageBtn = document.getElementById('cookie-manage');
      const saveBtn = document.getElementById('cookie-save');
      const cancelBtn = document.getElementById('cookie-cancel');
      const analyticsChk = document.getElementById('cookie-analytics');
      const marketingChk = document.getElementById('cookie-marketing');

      function read() {
        try { return JSON.parse(localStorage.getItem(KEY)); } catch(e) { return null; }
      }

      function write(prefs){
        try { localStorage.setItem(KEY, JSON.stringify(prefs)); } catch(e) { console.warn('cookie save failed', e); }
      }

      function applyPreferences(prefs){
        // Simple hooks: disable analytics scripts by adding data attribute or flag.
        // Consumers (analytics code) should check window.TILL_CONSENT.analytics
        window.TILL_CONSENT = prefs || {necessary:true,analytics:false,marketing:false};
        // Example: if there is a function initAnalytics and analytics allowed, call it.
        if (window.TILL_CONSENT.analytics && typeof window.initAnalytics === 'function') {
          try { window.initAnalytics(); } catch(e){}
        }
      }

      function showBanner(){ banner.classList.remove('hidden'); }
      function hideBanner(){ banner.classList.add('hidden'); }
      function showModal(){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
      function hideModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

      // Initialize
      const existing = read();
      if (!existing) {
        // no prefs yet -> show banner after small delay
        setTimeout(showBanner, 600);
      } else {
        applyPreferences(existing);
      }

      // Buttons
      acceptBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:true,marketing:true,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideBanner();
      });

      declineBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:false,marketing:false,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideBanner();
      });

      manageBtn?.addEventListener('click', function(){
        const prefs = read() || {necessary:true,analytics:false,marketing:false};
        analyticsChk.checked = !!prefs.analytics;
        marketingChk.checked = !!prefs.marketing;
        showModal();
      });

      saveBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:!!analyticsChk.checked,marketing:!!marketingChk.checked,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideModal(); hideBanner();
      });

      cancelBtn?.addEventListener('click', function(){ hideModal(); });

      // Expose a small API
      window.tillvalleCookie = {
        get: read,
        set: function(p){ write(p); applyPreferences(p); }
      };
    })();
  </script>
  <style>

  :root {
    --brand-500:#40916c;
    --muted:#64748b;
    --bg:#f6fbf7;
    --card:#ffffff;
    --glass:rgba(255,255,255,0.6);
    --radius:10px;
    --max-w:1100px;
  }
  *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#e8f6ef);color:#072018}

    /* Page container */
    #navbar-container{width:100%;}
    .shop-section{max-width:var(--max-w);margin:22px auto;padding:18px}
    .shop-section h2{font-size:1.8rem;margin:0 0 12px;color:var(--brand-600);letter-spacing:0.2px}

    /* Categories */
    .category{margin:18px 0}
    .category-title{font-weight:600;color:var(--brand-700);margin-bottom:8px}

    /* Product grid */
  .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .product{background:var(--card);border-radius:10px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;transition:transform .16s ease,box-shadow .16s ease;box-shadow:0 6px 18px rgba(3,8,6,0.06);min-height:180px}
    .product:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(3,8,6,0.08)}

  .product-image{width:100%;height:100px;object-fit:contain;border-radius:8px;background:linear-gradient(180deg,#fff,#f8fffb);padding:6px}
  .product h4{font-size:0.95rem;margin:8px 0 6px;text-align:center;color:#072018}
  .product .price{color:var(--muted);font-weight:700;margin-bottom:6px;font-size:0.95rem}

    /* Recently bought */
    .recent-section{margin:12px 0 20px;padding:8px 6px}
    .recent-title{font-size:1rem;margin:0 0 8px;color:var(--brand-700);font-weight:700}
    .recent-list{display:flex;gap:10px;flex-wrap:nowrap;overflow:auto;padding-bottom:6px}
    .recent-item{min-width:140px;background:var(--card);border-radius:10px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 6px 18px rgba(3,8,6,0.04)}
    .recent-image{width:84px;height:64px;object-fit:cover;border-radius:8px;background:#fff}
    .recent-name{font-size:0.9rem;text-align:center;color:#072018;font-weight:700}
    .recent-price{font-size:0.85rem;color:var(--muted)}
    .recent-buy-btn{background:transparent;border:1px solid var(--brand-600);color:var(--brand-600);padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:700}

    .product-controls{display:flex;align-items:center;gap:6px}
    .product-quantity{min-width:28px;text-align:center;font-weight:700}

    .product-btn{background:var(--brand-600);color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:14px;display:inline-flex;align-items:center;justify-content:center;transition:transform .12s ease}
    .product-btn:active{transform:scale(.98)}

    /* Improved product card look when clicked (visual focus) */
    .product:focus-within,.product:focus{outline:3px solid rgba(45,106,79,0.12);box-shadow:0 12px 30px rgba(16,24,40,0.06)}

  /* Modal - upgraded popup styling */
  .modal{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(4,10,6,0.55);z-index:120;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
    opacity:0;visibility:hidden;transition:opacity .22s ease,visibility .22s ease;
  }
  .modal.show{opacity:1;visibility:visible}

  .modal-content{
    background:linear-gradient(180deg,#ffffff,#f7fff7);
    border-radius:16px;max-width:920px;width:94%;padding:20px;display:grid;grid-template-columns:45% 55%;gap:20px;align-items:center;position:relative;
    box-shadow:0 36px 80px rgba(3,8,6,0.18);transform:translateY(8px) scale(.98);opacity:0;transition:transform .25s ease,opacity .25s ease;
  }
  .modal.show .modal-content{transform:translateY(0) scale(1);opacity:1}

  .modal-body{width:100%;display:flex;flex-direction:column;gap:6px}
  .modal-image{width:100%;height:300px;object-fit:cover;border-radius:12px;background:#fff;padding:10px;box-shadow:0 10px 30px rgba(3,8,6,0.06)}
  .modal-info{padding:6px;text-align:left}
  .modal-info h3{margin:0 0 8px;font-size:1.6rem;color:var(--brand-600);font-weight:800}
  .modal-info p{color:var(--muted);margin:0 0 10px;font-size:1rem;line-height:1.45}
  .modal-price{font-weight:900;color:var(--brand-600);margin-top:6px;font-size:1.15rem}

  .quantity-controls{display:flex;align-items:center;gap:12px;margin-top:12px}
  .quantity-btn{background:#f1f6f3;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;color:var(--brand-600);font-weight:800;font-size:18px;box-shadow:inset 0 -2px 0 rgba(0,0,0,0.02)}
  .quantity-display{min-width:36px;text-align:center;font-weight:800;font-size:1.05rem;padding:8px 6px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.04)}

  .modal-buttons{display:flex;align-items:center;gap:10px;margin-top:14px}
  .add-to-cart-btn{background:linear-gradient(90deg,var(--brand-600),#1e8c57);color:white;border:none;padding:8px 16px;border-radius:12px;cursor:pointer;font-weight:800;font-size:14px;box-shadow:0 12px 30px rgba(45,106,79,0.14)}
  .buy-now-btn{background:transparent;color:var(--brand-600);border:2px solid var(--brand-600);padding:8px 16px;border-radius:12px;cursor:pointer;font-weight:800}

  /* Close button */
  .modal .close{position:absolute;top:12px;right:12px;background:#fff;border:none;color:var(--brand-700);font-size:20px;cursor:pointer;padding:8px;border-radius:50%;box-shadow:0 8px 20px rgba(0,0,0,0.08)}
  .modal .close:hover{transform:scale(1.05)}

  /* Affirmative action small icon button (check) */
  .confirm-icon{display:inline-flex;align-items:center;justify-content:center;width:54px;height:44px;border-radius:28px;background:linear-gradient(180deg,var(--brand-600),#1e8c57);color:white;border:none;box-shadow:0 10px 30px rgba(45,106,79,0.18);font-size:18px}

    /* Toast */
    .toast{position:fixed;right:24px;bottom:30px;background:linear-gradient(90deg,var(--brand-600),#56c39f);color:white;padding:12px 18px;border-radius:999px;box-shadow:0 8px 30px rgba(3,8,6,0.12);z-index:9999;font-weight:700}

    /* Loading screen */
    #loading-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#e6f0ff,#e6fff3);z-index:9999}
    .loading-logo{width:74px;height:74px;border-radius:50%;background:url('logo.jpg') center/cover}

    /* Utility */
    .hidden{display:none}

  /* Cookie consent banner */
  .cookie-banner{position:fixed;left:20px;right:20px;bottom:20px;background:linear-gradient(90deg,#ffffff,#f7fff7);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 18px 40px rgba(3,8,6,0.12);z-index:99999;max-width:1100px;margin:0 auto;justify-content:space-between}
  .cookie-banner .cookie-text{flex:1;color:#083322;font-size:0.95rem}
  .cookie-banner .cookie-actions{display:flex;gap:8px;align-items:center}
  .cookie-btn{background:var(--brand-600);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .cookie-link{background:transparent;border:1px solid rgba(6,34,20,0.06);padding:8px 12px;border-radius:8px;cursor:pointer;color:var(--brand-600);font-weight:700}

  /* Cookie manage modal */
  .cookie-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);background:#fff;border-radius:12px;padding:18px;box-shadow:0 30px 60px rgba(3,8,6,0.18);z-index:100000;max-width:520px;width:94%;opacity:0;visibility:hidden;transition:opacity .18s ease,transform .18s ease}
  .cookie-modal.show{opacity:1;visibility:visible;transform:translate(-50%,-50%) scale(1)}
  .cookie-modal h4{margin:0 0 10px}
  .cookie-toggle{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-top:1px solid #eef6f0}
  .cookie-toggle:first-of-type{border-top:0}
  .cookie-small{font-size:0.9rem;color:var(--muted)}

  @media (max-width:900px){.modal-content{flex-direction:column;align-items:center}.modal-image{width:80%;height:180px}}
  @media (max-width:480px){
    .products{grid-template-columns:repeat(2,1fr);gap:8px}
    .product-image{height:90px}
    .product{min-height:180px;padding:8px}
    .product h4{font-size:0.85rem;margin:6px 0 4px}
    .product .price{font-size:0.9rem;margin-bottom:4px}
    .product-controls{gap:4px}
    .product-btn{width:32px;height:32px;font-size:16px}
    .product-quantity{min-width:24px;font-size:0.9rem}
    .shop-section{margin:16px auto;padding:12px}
    .shop-section h2{font-size:1.6rem;margin:0 0 8px}
    .category-title{font-size:1rem;margin-bottom:6px}
    .recent-section{margin:8px 0 16px;padding:6px 4px}
    .recent-title{font-size:0.9rem;margin:0 0 6px}
    .recent-list{gap:8px;padding-bottom:4px}
    .recent-item{min-width:120px;padding:6px}
    .recent-image{width:72px;height:56px}
    .recent-name{font-size:0.8rem}
    .recent-price{font-size:0.75rem}
    .modal-content{max-width:95%;width:95%;padding:20px 20px}
    .modal-image{width:160px;height:120px}
    .modal-info h3{font-size:1.4rem}
    .modal-price{font-size:0.95rem}
    .quantity-controls{gap:10px;margin-top:6px}
    .quantity-btn{padding:10px 12px;font-size:16px}
    .quantity-display{min-width:24px;font-size:0.95rem}
    .add-to-cart-btn,.buy-now-btn{padding:10px 18px;font-size:14px}
  }
  </style>
</head>
<body>
  <div id="navbar-container"></div>

  <section class="shop-section">
    <h2>Fresh Farm Produce</h2>
    <!-- Recently bought (persisted in localStorage) -->
    <div class="recent-section">
      <h3 class="recent-title">Recently Bought</h3>
      <div class="recent-list" id="recent-list" aria-live="polite"></div>
    </div>
    
    <!-- Category: Animal & Farm Produce -->
    <div class="category">
      <h3 class="category-title">Animal & Farm Produce</h3>
      <div class="products animal-farm">
  <div class="product" data-name="Fresh Milk" data-description="Pure, fresh milk from our farm." data-image="milk.png" data-price="120"><img src="milk.png" alt="Fresh Milk" class="product-image"><h4>Fresh Milk</h4><p class="price" data-price="120">KES 120 / liter</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Fresh Milk">‚àí</button><span class="product-quantity" id="qty-Fresh-Milk">0</span><button class="product-btn" data-action="add" data-name="Fresh Milk" data-price="120" data-image="milk.png">+</button></div></div>
  <div class="product" data-name="Free-Range Chicken" data-description="Healthy, free-range chicken." data-image="chicken.png" data-price="800"><img src="chicken.png" alt="Free-Range Chicken" class="product-image"><h4>Free-Range Chicken</h4><p class="price" data-price="800">KES 800 / kg</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Free-Range Chicken">‚àí</button><span class="product-quantity" id="qty-Free-Range-Chicken">0</span><button class="product-btn" data-action="add" data-name="Free-Range Chicken" data-price="800" data-image="chicken.png">+</button></div></div>
  <div class="product" data-name="Farm Fresh Eggs" data-description="Fresh eggs from free-range chickens." data-image="eggs.png" data-price="25"><img src="eggs.png" alt="Farm Fresh Eggs" class="product-image"><h4>Farm Fresh Eggs</h4><p class="price" data-price="25">KES 25 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Farm Fresh Eggs">‚àí</button><span class="product-quantity" id="qty-Farm-Fresh-Eggs">0</span><button class="product-btn" data-action="add" data-name="Farm Fresh Eggs" data-price="25" data-image="eggs.png">+</button></div></div>
  <div class="product" data-name="Pure Ghee" data-description="Traditional clarified butter." data-image="ghee.png" data-price="600"><img src="ghee.png" alt="Pure Ghee" class="product-image"><h4>Pure Ghee</h4><p class="price" data-price="600">KES 600 / 500g</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pure Ghee">‚àí</button><span class="product-quantity" id="qty-Pure-Ghee">0</span><button class="product-btn" data-action="add" data-name="Pure Ghee" data-price="600" data-image="ghee.png">+</button></div></div>
  <div class="product" data-name="Honey" data-description="Pure, natural honey from local beekeepers." data-image="honey.png" data-price="400"><img src="honey.png" alt="Honey" class="product-image"><h4>Honey</h4><p class="price" data-price="400">KES 400 / 500g</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Honey">‚àí</button><span class="product-quantity" id="qty-Honey">0</span><button class="product-btn" data-action="add" data-name="Honey" data-price="400" data-image="honey.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Fruits -->
    <div class="category">
      <h3 class="category-title">Fruits</h3>
      <div class="products">
  <div class="product" data-name="Bananas" data-description="Fresh bananas, perfect for snacking." data-image="bananas-ripe.png" data-price="150"><img src="bananas-ripe.png" alt="Bananas" class="product-image"><h4>Bananas</h4><p class="price" data-price="150">KES 150 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Bananas">‚àí</button><span class="product-quantity" id="qty-Bananas">0</span><button class="product-btn" data-action="add" data-name="Bananas" data-price="150" data-image="bananas-ripe.png">+</button></div></div>
  <div class="product" data-name="Oranges" data-description="Juicy oranges, rich in vitamin C." data-image="oranges.png" data-price="200"><img src="oranges.png" alt="Oranges" class="product-image"><h4>Oranges</h4><p class="price" data-price="200">KES 200 / kg</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Oranges">‚àí</button><span class="product-quantity" id="qty-Oranges">0</span><button class="product-btn" data-action="add" data-name="Oranges" data-price="200" data-image="oranges.png">+</button></div></div>

  <div class="product" data-name="Watermelon" data-description="Sweet watermelon, perfect for hot days." data-image="watermelon.png" data-price="250"><img src="watermelon.png" alt="Watermelon" class="product-image"><h4>Watermelon</h4><p class="price" data-price="250">KES 250 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Watermelon">‚àí</button><span class="product-quantity" id="qty-Watermelon">0</span><button class="product-btn" data-action="add" data-name="Watermelon" data-price="250" data-image="watermelon.png">+</button></div></div>
  <div class="product" data-name="Mangoes" data-description="Juicy mangoes, perfect for summer." data-image="mangoes.png" data-price="40"><img src="mangoes.png" alt="Mangoes" class="product-image"><h4>Mangoes</h4><p class="price" data-price="40">KES 40 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Mangoes">‚àí</button><span class="product-quantity" id="qty-Mangoes">0</span><button class="product-btn" data-action="add" data-name="Mangoes" data-price="40" data-image="mangoes.png">+</button></div></div>
  <div class="product" data-name="Lemon" data-description="Fresh lemons for cooking and drinks." data-image="lemon.png" data-price="20"><img src="lemon.png" alt="Lemon" class="product-image"><h4>Lemon</h4><p class="price" data-price="20">KES 20 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Lemon">‚àí</button><span class="product-quantity" id="qty-Lemon">0</span><button class="product-btn" data-action="add" data-name="Lemon" data-price="20" data-image="lemon.png">+</button></div></div>
  <div class="product" data-name="Pawpaw" data-description="Sweet pawpaw fruit, rich in vitamins." data-image="pawpaw.png" data-price="120"><img src="pawpaw.png" alt="Pawpaw" class="product-image"><h4>Pawpaw</h4><p class="price" data-price="120">KES 120 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pawpaw">‚àí</button><span class="product-quantity" id="qty-Pawpaw">0</span><button class="product-btn" data-action="add" data-name="Pawpaw" data-price="120" data-image="pawpaw.png">+</button></div></div>
  <div class="product" data-name="Pixies" data-description="Mini sweet oranges, great for snacking." data-image="pixies.png" data-price="35"><img src="pixies.png" alt="Pixies" class="product-image"><h4>Pixies</h4><p class="price" data-price="35">KES 35 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pixies">‚àí</button><span class="product-quantity" id="qty-Pixies">0</span><button class="product-btn" data-action="add" data-name="Pixies" data-price="35" data-image="pixies.png">+</button></div></div>
  <div class="product" data-name="Avocadoes" data-description="Creamy avocados for healthy eating." data-image="avocadoes.png" data-price="30"><img src="avocadoes.png" alt="Avocadoes" class="product-image"><h4>Avocadoes</h4><p class="price" data-price="30">KES 30 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Avocadoes">‚àí</button><span class="product-quantity" id="qty-Avocadoes">0</span><button class="product-btn" data-action="add" data-name="Avocadoes" data-price="30" data-image="avocadoes.png">+</button></div></div>
  <div class="product" data-name="Yellow Passion" data-description="Tangy passion fruit for juices." data-image="yellow-passion.png" data-price="25"><img src="yellow-passion.png" alt="Yellow Passion" class="product-image"><h4>Yellow Passion</h4><p class="price" data-price="25">KES 25 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Yellow Passion">‚àí</button><span class="product-quantity" id="qty-Yellow-Passion">0</span><button class="product-btn" data-action="add" data-name="Yellow Passion" data-price="25" data-image="yellow-passion.png">+</button></div></div>
  <div class="product" data-name="Kiwi" data-description="Nutritious kiwi fruit, full of vitamin C." data-image="kiwi.png" data-price="60"><img src="kiwi.png" alt="Kiwi" class="product-image"><h4>Kiwi</h4><p class="price" data-price="60">KES 60 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kiwi">‚àí</button><span class="product-quantity" id="qty-Kiwi">0</span><button class="product-btn" data-action="add" data-name="Kiwi" data-price="60" data-image="kiwi.png">+</button></div></div>
  <div class="product" data-name="Raw Bananas" data-description="Green bananas for cooking." data-image="raw-bananas.png" data-price="100"><img src="raw-bananas.png" alt="Raw Bananas" class="product-image"><h4>Raw Bananas</h4><p class="price" data-price="100">KES 100 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Raw Bananas">‚àí</button><span class="product-quantity" id="qty-Raw-Bananas">0</span><button class="product-btn" data-action="add" data-name="Raw Bananas" data-price="100" data-image="raw-bananas.png">+</button></div></div>
  <div class="product" data-name="Dragon Fruit" data-description="Exotic dragon fruit, sweet and nutritious." data-image="dragonfruit.png" data-price="300"><img src="dragonfruit.png" alt="Dragon Fruit" class="product-image"><h4>Dragon Fruit</h4><p class="price" data-price="300">KES 300 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Dragon Fruit">‚àí</button><span class="product-quantity" id="qty-Dragon-Fruit">0</span><button class="product-btn" data-action="add" data-name="Dragon Fruit" data-price="300" data-image="dragonfruit.png">+</button></div></div>
  <div class="product" data-name="Soursop" data-description="Tropical soursop fruit, great for juices." data-image="soursop.png" data-price="250"><img src="soursop.png" alt="Soursop" class="product-image"><h4>Soursop</h4><p class="price" data-price="250">KES 250 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Soursop">‚àí</button><span class="product-quantity" id="qty-Soursop">0</span><button class="product-btn" data-action="add" data-name="Soursop" data-price="250" data-image="soursop.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Herbs -->
    <div class="category">
      <h3 class="category-title">Herbs</h3>
      <div class="products">
  <div class="product" data-name="Basil" data-description="Fresh basil leaves for cooking." data-image="basil.png" data-price="50"><img src="basil.png" alt="Basil" class="product-image"><h4>Basil</h4><p class="price" data-price="50">KES 50 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Basil">‚àí</button><span class="product-quantity" id="qty-Basil">0</span><button class="product-btn" data-action="add" data-name="Basil" data-price="50" data-image="basil.png">+</button></div></div>
  <div class="product" data-name="Coriander" data-description="Aromatic coriander leaves and seeds." data-image="coriander.png" data-price="30"><img src="coriander.png" alt="Coriander" class="product-image"><h4>Coriander</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Coriander">‚àí</button><span class="product-quantity" id="qty-Coriander">0</span><button class="product-btn" data-action="add" data-name="Coriander" data-price="30" data-image="coriander.png">+</button></div></div>
  <div class="product" data-name="Mint" data-description="Fresh mint leaves for cooking and drinks." data-image="mint.png" data-price="40"><img src="mint.png" alt="Mint" class="product-image"><h4>Mint</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Mint">‚àí</button><span class="product-quantity" id="qty-Mint">0</span><button class="product-btn" data-action="add" data-name="Mint" data-price="40" data-image="mint.png">+</button></div></div>
  <div class="product" data-name="Parsley" data-description="Fresh parsley leaves for cooking." data-image="parsley.png" data-price="35"><img src="parsley.png" alt="Parsley" class="product-image"><h4>Parsley</h4><p class="price" data-price="35">KES 35 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Parsley">‚àí</button><span class="product-quantity" id="qty-Parsley">0</span><button class="product-btn" data-action="add" data-name="Parsley" data-price="35" data-image="parsley.png">+</button></div></div>
  <div class="product" data-name="Soursop Leaves" data-description="Medicinal soursop leaves." data-image="soursop-herbs.png" data-price="200"><img src="soursop-herbs.png" alt="Soursop Leaves" class="product-image"><h4>Soursop Leaves</h4><p class="price" data-price="200">from KES 200</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Soursop Leaves">‚àí</button><span class="product-quantity" id="qty-Soursop-Leaves">0</span><button class="product-btn" data-action="add" data-name="Soursop Leaves" data-price="200" data-image="soursop-herbs.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Vegetables & Greens -->
    <div class="category">
      <h3 class="category-title">Vegetables & Greens</h3>
      <div class="products">
  <div class="product" data-name="Kales (Sukuma Wiki)" data-description="Nutritious kales, perfect for sukuma wiki." data-image="kales.png" data-price="30"><img src="kales.png" alt="Kales (Sukuma Wiki)" class="product-image"><h4>Kales (Sukuma Wiki)</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kales (Sukuma Wiki)">‚àí</button><span class="product-quantity" id="qty-Kales-(Sukuma-Wiki)">0</span><button class="product-btn" data-action="add" data-name="Kales (Sukuma Wiki)" data-price="30" data-image="kales.png">+</button></div></div>
  <div class="product" data-name="Lettuce" data-description="Fresh, crisp lettuce for salads." data-image="lettuce.png" data-price="80"><img src="lettuce.png" alt="Lettuce" class="product-image"><h4>Lettuce</h4><p class="price" data-price="80">KES 80 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Lettuce">‚àí</button><span class="product-quantity" id="qty-Lettuce">0</span><button class="product-btn" data-action="add" data-name="Lettuce" data-price="80" data-image="lettuce.png">+</button></div></div>
  <div class="product" data-name="Managu" data-description="Traditional African vegetable." data-image="managu.png" data-price="40"><img src="managu.png" alt="Managu" class="product-image"><h4>Managu</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Managu">‚àí</button><span class="product-quantity" id="qty-Managu">0</span><button class="product-btn" data-action="add" data-name="Managu" data-price="40" data-image="managu.png">+</button></div></div>
  <div class="product" data-name="Terere" data-description="Fresh terere leaves for cooking." data-image="terere.png" data-price="40"><img src="terere.png" alt="Terere" class="product-image"><h4>Terere</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Terere">‚àí</button><span class="product-quantity" id="qty-Terere">0</span><button class="product-btn" data-action="add" data-name="Terere" data-price="40" data-image="terere.png">+</button></div></div>
  <div class="product" data-name="Salgaa" data-description="Fresh salgaa for traditional dishes." data-image="salgaa.png" data-price="20"><img src="salgaa.png" alt="Salgaa" class="product-image"><h4>Salgaa</h4><p class="price" data-price="20">KES 20 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Salgaa">‚àí</button><span class="product-quantity" id="qty-Salgaa">0</span><button class="product-btn" data-action="add" data-name="Salgaa" data-price="20" data-image="salgaa.png">+</button></div></div>
  <div class="product" data-name="Spinach" data-description="Fresh spinach leaves, rich in iron." data-image="spinach.png" data-price="30"><img src="spinach.png" alt="Spinach" class="product-image"><h4>Spinach</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Spinach">‚àí</button><span class="product-quantity" id="qty-Spinach">0</span><button class="product-btn" data-action="add" data-name="Spinach" data-price="30" data-image="spinach.png">+</button></div></div>
  <div class="product" data-name="Cauliflower" data-description="Fresh cauliflower, perfect for healthy meals." data-image="cauliflower.png" data-price="80"><img src="cauliflower.png" alt="Cauliflower" class="product-image"><h4>Cauliflower</h4><p class="price" data-price="80">KES 80 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Cauliflower">‚àí</button><span class="product-quantity" id="qty-Cauliflower">0</span><button class="product-btn" data-action="add" data-name="Cauliflower" data-price="80" data-image="cauliflower.png">+</button></div></div>
  <div class="product" data-name="Broccoli" data-description="Nutritious broccoli, rich in vitamins." data-image="broccoli.png" data-price="70"><img src="broccoli.png" alt="Broccoli" class="product-image"><h4>Broccoli</h4><p class="price" data-price="70">KES 70 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Broccoli">‚àí</button><span class="product-quantity" id="qty-Broccoli">0</span><button class="product-btn" data-action="add" data-name="Broccoli" data-price="70" data-image="broccoli.png">+</button></div></div>
  <div class="product" data-name="Kunde" data-description="Fresh kunde leaves for traditional dishes." data-image="kunde.png" data-price="40"><img src="kunde.png" alt="Kunde" class="product-image"><h4>Kunde</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kunde">‚àí</button><span class="product-quantity" id="qty-Kunde">0</span><button class="product-btn" data-action="add" data-name="Kunde" data-price="40" data-image="kunde.png">+</button></div></div>
      </div>
    </div>
  </section>

  <!-- Shipping & Payment Info -->
  <section class="shipping-payment-section">
    <h2>Shipping & Payment</h2>
    <div class="shipping-info">
      <h3>Delivery Zones & Prices</h3>
      <div class="delivery-zones">
        <div class="zone">
          <h4>Nairobi</h4>
          <p>KES 200 (Same day delivery)</p>
        </div>
        <div class="zone">
          <h4>Kiambu</h4>
          <p>KES 150 (Next day delivery)</p>
        </div>
        <div class="zone">
          <h4>Other Areas</h4>
          <p>KES 300 (2-3 days delivery)</p>
        </div>
      </div>
      <p class="free-delivery">Free delivery on orders over KES 2000!</p>
    </div>
    <div class="payment-options">
      <h3>Payment Methods</h3>
      <div class="payment-methods">
        <div class="payment-method">
          <span class="payment-icon">üì±</span>
          <div>
            <h4>M-Pesa</h4>
            <p>Pay with your mobile money</p>
          </div>
        </div>
        <div class="payment-method">
          <span class="payment-icon">üí≥</span>
          <div>
            <h4>Credit/Debit Card</h4>
            <p>Secure online payments</p>
          </div>
        </div>
        <div class="payment-method">
          <span class="payment-icon">üè¶</span>
          <div>
            <h4>Bank Transfer</h4>
            <p>Direct bank payments</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Product Modal -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <button class="close">&times;</button>
      <div class="modal-body">
        <img id="modal-image" src="" alt="" class="modal-image">
        <div class="modal-info">
          <h3 id="modal-title"></h3>
          <p id="modal-description"></p>
          <div id="modal-details" class="modal-details"></div>
          <div id="modal-price" class="modal-price"></div>
          <div class="quantity-selector">
            <label for="quantity">Select Quantity</label>
            <div class="quantity-controls">
                <button type="button" class="quantity-btn" data-action="decrease">‚àí</button>
                <input type="number" id="quantity" min="1" value="1" readonly>
                <button type="button" class="quantity-btn" data-action="increase">+</button>
              </div>
          </div>
          <div class="modal-buttons">
            <button id="add-to-cart-btn" class="add-to-cart-btn">üõí Add to Cart</button>
            <button id="buy-now-btn" class="buy-now-btn">‚ö° Buy Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 TillValle. All rights reserved.</p>
  </footer>

  <!-- Cookie consent banner -->
  <div id="cookie-consent" class="cookie-banner hidden" role="dialog" aria-live="polite">
    <div class="cookie-text">We use cookies to improve your experience. Some are required for site functionality. By clicking "Accept All" you agree to our use of analytics and marketing cookies. <a href="privacy.html" style="color:var(--brand-600);font-weight:700;text-decoration:underline;margin-left:6px">Privacy policy</a></div>
    <div class="cookie-actions">
      <button id="cookie-decline" class="cookie-link">Decline Non-Essential</button>
      <button id="cookie-manage" class="cookie-link">Manage</button>
      <button id="cookie-accept" class="cookie-btn">Accept All</button>
    </div>
  </div>

  <!-- Cookie manage modal -->
  <div id="cookie-modal" class="cookie-modal" aria-hidden="true">
    <h4>Cookie preferences</h4>
    <div class="cookie-small">Toggle which cookies you allow. Necessary cookies are always enabled.</div>
    <div class="cookie-toggle" data-key="necessary">
      <div>
        <strong>Necessary</strong>
        <div class="cookie-small">Required for core site functionality.</div>
      </div>
      <div><input type="checkbox" disabled checked></div>
    </div>
    <div class="cookie-toggle" data-key="analytics">
      <div>
        <strong>Analytics</strong>
        <div class="cookie-small">Helps us understand site usage (optional).</div>
      </div>
      <div><input type="checkbox" id="cookie-analytics"></div>
    </div>
    <div class="cookie-toggle" data-key="marketing">
      <div>
        <strong>Marketing</strong>
        <div class="cookie-small">Used for personalized offers (optional).</div>
      </div>
      <div><input type="checkbox" id="cookie-marketing"></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="cookie-save" class="cookie-btn">Save preferences</button>
      <button id="cookie-cancel" class="cookie-link">Cancel</button>
    </div>
  </div>

  <!-- Chatbot Sidebar -->
  <div class="chatbot-sidebar" id="chatbot-sidebar">
    <div class="chatbot-header">
      <span>ü§ñ TillieBot</span>
      <button class="chatbot-close" id="chatbot-close">&times;</button>
    </div>
    <div class="chatbot-messages" id="chatbot-messages">
      <div class="chatbot-message bot">
        üå± Hello! Welcome to TillValle! I'm TillieBot, your smart farming assistant. How can I help you today?
      </div>
    </div>
    <div class="chatbot-input-area">
      <div class="chatbot-input-container">
        <input type="text" id="chatbot-input" placeholder="Ask me about products, delivery, or stock..." class="chatbot-input">
        <button id="chatbot-send" class="chatbot-send">üì§</button>
      </div>
    </div>
  </div>

  <!-- Chatbot Backdrop -->
  <div class="chatbot-backdrop" id="chatbot-backdrop"></div>



  <script>
    // Load navbar
    fetch('navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navbar-container').innerHTML = data;
        // Load navbar-universal.js after navbar is loaded
        const script = document.createElement('script');
        script.src = 'navbar-universal.js';
        script.onload = function() {
          if (typeof initNavbar === 'function') {
            initNavbar();
          }
        };
        document.head.appendChild(script);
    });

    // Product modal functionality
    let modalCurrentProduct = {};

    function openProductModal(name, description, image, price) {
      modalCurrentProduct = { name, description, image, price };
      
      document.getElementById('modal-title').textContent = name;
      document.getElementById('modal-description').textContent = description;
      document.getElementById('modal-price').textContent = 'KES ' + price;
      document.getElementById('modal-image').src = image;
      document.getElementById('modal-image').alt = name;
      document.getElementById('quantity').value = 1;
      
      const modal = document.getElementById('product-modal');
      modal.style.display = 'flex';
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
      const modal = document.getElementById('product-modal');
      modal.style.display = 'none';
      modal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }
    
    window.closeModal = closeModal;
    
  // Close modal (defensive)
  const closeBtn = document.querySelector('.close');
  if (closeBtn) closeBtn.addEventListener('click', closeModal);
    
    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('product-modal');
      if (event.target === modal) {
        closeModal();
      }
    };
    
    // Quantity controls (unobtrusive). Attach listeners instead of inline onclicks.
    (function() {
      const modal = document.getElementById('product-modal');

      // Modal-level quantity buttons (increase/decrease)
      if (modal) {
        modal.addEventListener('click', function(e) {
          const btn = e.target.closest('.quantity-btn');
          if (!btn) return;
          const action = btn.dataset.action;
          const input = document.getElementById('quantity');
          if (!input) return;
          let v = parseInt(input.value, 10) || 1;
          if (action === 'increase') v++;
          else if (action === 'decrease' && v > 1) v--;
          input.value = v;
        });
      }

      // Delegated product grid handlers: + / - buttons and product click to open modal
      document.addEventListener('click', function(e) {
        const control = e.target.closest('.product-btn');
        if (control) {
          const action = control.dataset.action;
          const product = control.closest('.product');
          if (!product) return;
          const qtySpan = product.querySelector('.product-quantity');
          let cur = parseInt(qtySpan.textContent, 10) || 0;
          if (action === 'add') cur++;
          else if (action === 'remove' && cur > 0) cur--;
          qtySpan.textContent = cur;
          return; // handled
        }

        // redirect to product details page when clicking a product (but ignore clicks inside controls)
        const productCard = e.target.closest('.product');
        if (productCard && !e.target.closest('.product-controls')) {
          const name = productCard.dataset.name || '';
          const desc = productCard.dataset.description || '';
          const img = productCard.dataset.image || productCard.querySelector('.product-image')?.src || '';
          const price = productCard.dataset.price || productCard.querySelector('.price')?.dataset.price || '';
          const url = `product.html?name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}&image=${encodeURIComponent(img)}&description=${encodeURIComponent(desc)}`;
          window.location.href = url;
        }
      });
    })();
    
    // Add to cart functionality
    const addToCartBtn = document.getElementById('add-to-cart-btn');
    if (addToCartBtn) addToCartBtn.addEventListener('click', function() {
      const quantity = parseInt(document.getElementById('quantity').value);
      if (quantity > 0) {
        // Persist as a recent purchase
        try {
          saveRecentPurchase(modalCurrentProduct, quantity);
          renderRecentPurchases();
        } catch (e) {
          // ignore storage errors (e.g., private mode)
          console.warn('Could not save recent purchase', e);
        }

        // Add animation to button
        const btn = this;
        btn.style.transform = 'scale(0.95)';
        btn.textContent = '‚úì Added!';
        
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
          btn.textContent = 'üõí Add to Cart';
          closeModal();
        }, 1000);
        
        // Show toast notification
        showToast(`Added ${quantity}x ${modalCurrentProduct.name} to cart!`);
      }
    });

    // Recent purchases: storage & rendering
    function getRecentPurchases() {
      try {
        const raw = localStorage.getItem('tillvalle_recent_purchases');
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        return [];
      }
    }

    function saveRecentPurchase(product, quantity) {
      if (!product || !product.name) return;
      const list = getRecentPurchases();
      const entry = {
        name: product.name,
        image: product.image || '',
        price: product.price || product.price === 0 ? product.price : (product.price || ''),
        qty: quantity || 1,
        ts: Date.now()
      };

      // Remove any previous entry with same name
      const filtered = list.filter(it => it.name !== entry.name);
      filtered.unshift(entry); // most recent first
      const limited = filtered.slice(0, 8);
      try { localStorage.setItem('tillvalle_recent_purchases', JSON.stringify(limited)); } catch (e) { /* ignore */ }
    }

    function renderRecentPurchases() {
      const container = document.getElementById('recent-list');
      if (!container) return;
      const list = getRecentPurchases();
      container.innerHTML = '';
      if (!list.length) {
        container.innerHTML = '<div class="recent-empty">No recent purchases yet ‚Äî buy something and it will appear here.</div>';
        return;
      }
      list.forEach(item => {
        const node = document.createElement('div');
        node.className = 'recent-item';
        node.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="recent-image">
          <div class="recent-name">${item.name}</div>
          <div class="recent-price">KES ${item.price} √ó ${item.qty}</div>
          <button class="recent-buy-btn" data-name="${escapeHtmlAttr(item.name)}" data-image="${escapeHtmlAttr(item.image)}" data-price="${escapeHtmlAttr(item.price)}">Buy again</button>
        `;
        container.appendChild(node);
      });
    }

    // Utility escape for attribute insertion
    function escapeHtmlAttr(s) {
      if (s === undefined || s === null) return '';
      return String(s).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    // Handle buy-again clicks (delegated)
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.recent-buy-btn');
      if (!btn) return;
      const name = btn.dataset.name || '';
      const image = btn.dataset.image || '';
      const price = btn.dataset.price || '';
      openProductModal(name, '', image, price);
      // default to 1 quantity in modal
      const qtyInput = document.getElementById('quantity'); if (qtyInput) qtyInput.value = 1;
    });

    // render on load
    renderRecentPurchases();
    
  // Toast notification
    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #00b894, #00cec9);
        color: white;
        padding: 15px 25px;
        border-radius: 50px;
        box-shadow: 0 8px 25px rgba(0,184,148,0.3);
        z-index: 999999;
        font-weight: 600;
        transform: translateY(100px);
        transition: all 0.3s ease;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.style.transform = 'translateY(0)', 100);
      setTimeout(() => {
        toast.style.transform = 'translateY(100px)';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }
  </script>

  <script src="maintenance.js"></script>
  <script src="navbar-universal.js"></script>
  <script src="script.js" defer></script>
  <script src="global-chat.js"></script>
<script>
(function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="qec3elonJWqywDRATwocl";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>
  <!-- Structured data: ItemList of visible products for SEO -->
  <script>
    (function(){
      try {
        const products = Array.from(document.querySelectorAll('.product'));
        const itemList = products.map((prod, idx) => {
          const name = prod.dataset.name || (prod.querySelector('h4') && prod.querySelector('h4').textContent.trim()) || '';
          const img = prod.dataset.image || (prod.querySelector('img') && prod.querySelector('img').src) || '';
          const price = prod.dataset.price || (prod.querySelector('.price') && prod.querySelector('.price').dataset && prod.querySelector('.price').dataset.price) || '';
          const sku = (prod.dataset.sku) || name.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');
          return {
            "@type": "ListItem",
            position: idx + 1,
            item: {
              "@type": "Product",
              name: name,
              image: img,
              sku: sku,
              offers: {
                "@type": "Offer",
                priceCurrency: "KES",
                price: price ? String(price) : "0",
                availability: "http://schema.org/InStock"
              }
            }
          };
        });

        const ld = {
          "@context": "https://schema.org",
          "@type": "ItemList",
          itemListElement: itemList
        };

        const s = document.createElement('script');
        s.type = 'application/ld+json';
        s.text = JSON.stringify(ld);
        document.head.appendChild(s);
      } catch (e) {
        console.warn('structured data generation failed', e);
      }
    })();
  </script>
</body>
</html>
