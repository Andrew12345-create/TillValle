<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop - TillValle</title>
  <link rel="stylesheet" href="css/site.css">
  <link rel="stylesheet" href="css/navbar.css">
  <link rel="icon" href="logo.jpg" type="image/jpeg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

  <link rel="stylesheet" href="global-chat.css">
  <link rel="stylesheet" href="auth-styles.css">
  <link rel="stylesheet" href="shipping-widget.css">
  <link rel="stylesheet" href="cookie-widget.css">
  <script data-id="cmi7m0fwy0009kz04yac3babp" src="https://tinychat.ai/tinychat.js"></script>
  <!-- Hotjar Tracking Code -->
  <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:5208839,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
  <script>
    // Cookie consent logic - store preferences in localStorage under 'tillvalle_cookie_consent'
    (function(){
      const KEY = 'tillvalle_cookie_consent';
      const banner = document.getElementById('cookie-consent');
      const modal = document.getElementById('cookie-modal');
      const acceptBtn = document.getElementById('cookie-accept');
      const declineBtn = document.getElementById('cookie-decline');
      const manageBtn = document.getElementById('cookie-manage');
      const saveBtn = document.getElementById('cookie-save');
      const cancelBtn = document.getElementById('cookie-cancel');
      const analyticsChk = document.getElementById('cookie-analytics');
      const marketingChk = document.getElementById('cookie-marketing');

      function read() {
        try { return JSON.parse(localStorage.getItem(KEY)); } catch(e) { return null; }
      }

      function write(prefs){
        try { localStorage.setItem(KEY, JSON.stringify(prefs)); } catch(e) { console.warn('cookie save failed', e); }
      }

      function applyPreferences(prefs){
        // Simple hooks: disable analytics scripts by adding data attribute or flag.
        // Consumers (analytics code) should check window.TILL_CONSENT.analytics
        window.TILL_CONSENT = prefs || {necessary:true,analytics:false,marketing:false};
        // Example: if there is a function initAnalytics and analytics allowed, call it.
        if (window.TILL_CONSENT.analytics && typeof window.initAnalytics === 'function') {
          try { window.initAnalytics(); } catch(e){}
        }
      }

      function showBanner(){ banner.classList.remove('hidden'); }
      function hideBanner(){ banner.classList.add('hidden'); }
      function showModal(){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }
      function hideModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }

      // Initialize
      const existing = read();
      if (!existing) {
        // no prefs yet -> show banner after small delay
        setTimeout(showBanner, 600);
      } else {
        applyPreferences(existing);
      }

      // Buttons
      acceptBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:true,marketing:true,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideBanner();
      });

      declineBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:false,marketing:false,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideBanner();
      });

      manageBtn?.addEventListener('click', function(){
        const prefs = read() || {necessary:true,analytics:false,marketing:false};
        analyticsChk.checked = !!prefs.analytics;
        marketingChk.checked = !!prefs.marketing;
        showModal();
      });

      saveBtn?.addEventListener('click', function(){
        const prefs = {necessary:true,analytics:!!analyticsChk.checked,marketing:!!marketingChk.checked,ts:Date.now()};
        write(prefs); applyPreferences(prefs); hideModal(); hideBanner();
      });

      cancelBtn?.addEventListener('click', function(){ hideModal(); });

      // Expose a small API
      window.tillvalleCookie = {
        get: read,
        set: function(p){ write(p); applyPreferences(p); }
      };
    })();
  </script>
  <style>

  :root {
    --brand-500:#40916c;
    --brand-600:#2d6a4f;
    --brand-700:#1e3a32;
    --muted:#64748b;
    --bg:#f6fbf7;
    --card:#ffffff;
    --glass:rgba(255,255,255,0.6);
    --radius:15px;
    --max-w:1200px;
  }
  *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#e8f6ef);color:#072018}

    /* Page container */
    #navbar-container{width:100%;}
    .shop-section{max-width:var(--max-w);margin:40px auto;padding:25px}
    .shop-section h2{font-size:3rem;margin:0 0 20px;color:var(--brand-600);letter-spacing:-0.5px;font-weight:900;background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 50%,#16a34a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 4px 20px rgba(45,106,79,0.3);text-align:center;position:relative}
    .shop-section h2::after{content:'';position:absolute;bottom:-15px;left:50%;transform:translateX(-50%);width:120px;height:6px;background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 50%,#16a34a 100%);border-radius:10px;box-shadow:0 4px 15px rgba(45,106,79,0.4)}

    /* Enhanced Filters */
    .filters-container{display:flex;justify-content:center;align-items:center;gap:30px;margin:30px 0 50px;flex-wrap:wrap;background:linear-gradient(145deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:25px;padding:25px;box-shadow:0 15px 35px rgba(0,0,0,0.1),0 0 0 1px rgba(255,255,255,0.2),inset 0 2px 0 rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.3)}
    .search-filter{display:flex;align-items:center;gap:15px}
    .search-input-modern{padding:12px 20px;border:2px solid transparent;border-radius:25px;width:280px;font-size:16px;background:linear-gradient(135deg,#f8fafc 0%,#ffffff 100%);box-shadow:0 8px 20px rgba(0,0,0,0.1),inset 0 2px 0 rgba(255,255,255,0.3);transition:all .3s ease;font-weight:500}
    .search-input-modern:focus{outline:none;border-color:var(--brand-600);box-shadow:0 12px 30px rgba(45,106,79,0.2),inset 0 2px 0 rgba(255,255,255,0.4);transform:translateY(-2px)}
    .search-btn-modern{background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 100%);color:white;border:none;padding:12px 25px;border-radius:25px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 8px 20px rgba(45,106,79,0.4),inset 0 2px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden}
    .search-btn-modern::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .6s ease}
    .search-btn-modern:hover::before{left:100%}
    .search-btn-modern:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 12px 30px rgba(45,106,79,0.6),inset 0 2px 0 rgba(255,255,255,0.3)}
    .price-filter{display:flex;align-items:center;gap:15px}
    .filter-label{font-weight:700;color:var(--brand-600);font-size:16px;letter-spacing:0.3px}
    .price-select-modern{padding:12px 20px;border:2px solid transparent;border-radius:20px;background:linear-gradient(135deg,#f8fafc 0%,#ffffff 100%);font-size:16px;font-weight:600;color:var(--brand-600);cursor:pointer;transition:all .3s ease;box-shadow:0 8px 20px rgba(0,0,0,0.1),inset 0 2px 0 rgba(255,255,255,0.3);min-width:180px}
    .price-select-modern:focus{outline:none;border-color:var(--brand-600);box-shadow:0 12px 30px rgba(45,106,79,0.2),inset 0 2px 0 rgba(255,255,255,0.4);transform:translateY(-2px)}
    .price-select-modern:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(0,0,0,0.15)}

    @media (max-width:768px){.filters-container{flex-direction:column;gap:20px;padding:20px}.search-filter,.price-filter{width:100%;justify-content:center}.search-input-modern{width:100%;max-width:300px}.price-select-modern{width:100%;max-width:200px}}

    /* Enhanced Shipping & Payment Section */
    .shipping-payment-section{max-width:var(--max-w);margin:60px auto;padding:40px 25px;background:linear-gradient(145deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:30px;box-shadow:0 20px 50px rgba(0,0,0,0.15),0 0 0 1px rgba(255,255,255,0.2),inset 0 2px 0 rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.3)}
    .section-header{text-align:center;margin-bottom:40px}
    .section-header h2{font-size:2.5rem;font-weight:900;color:var(--brand-600);background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 50%,#16a34a 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;letter-spacing:-0.5px}
    .section-header p{font-size:1.2rem;color:var(--muted);font-weight:600}
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:40px;margin-top:40px}
    .shipping-card,.payment-card{background:linear-gradient(145deg,rgba(255,255,255,0.95) 0%,rgba(255,255,255,0.85) 100%);border-radius:25px;padding:30px;box-shadow:0 15px 35px rgba(0,0,0,0.1),0 0 0 1px rgba(255,255,255,0.2),inset 0 2px 0 rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.3);transition:all .3s ease}
    .shipping-card:hover,.payment-card:hover{transform:translateY(-5px);box-shadow:0 20px 50px rgba(0,0,0,0.15),0 0 0 2px rgba(34,197,94,0.2),inset 0 2px 0 rgba(255,255,255,0.4)}
    .card-header{display:flex;align-items:center;gap:15px;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid rgba(34,197,94,0.1)}
    .card-icon{font-size:2rem;background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 2px 5px rgba(45,106,79,0.3))}
    .card-header h3{font-size:1.5rem;font-weight:800;color:var(--brand-600);letter-spacing:0.3px}
    .delivery-zones{display:flex;flex-direction:column;gap:15px;margin-bottom:25px}
    .zone-card{background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 100%);border-radius:15px;padding:20px;border:2px solid rgba(22,163,74,0.1);transition:all .3s ease}
    .zone-card:hover{transform:translateX(5px);border-color:rgba(22,163,74,0.3);box-shadow:0 8px 20px rgba(22,163,74,0.1)}
    .zone-info h4{font-size:1.2rem;font-weight:700;color:var(--brand-600);margin-bottom:8px}
    .zone-price{font-size:1.4rem;font-weight:900;color:#16a34a;margin-bottom:5px}
    .zone-time{font-size:0.9rem;color:var(--muted);font-weight:600}
    .free-delivery-banner{background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);border-radius:15px;padding:20px;text-align:center;border:2px solid rgba(245,158,11,0.2);position:relative;overflow:hidden}
    .free-delivery-banner::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .6s ease}
    .free-delivery-banner:hover::before{left:100%}
    .banner-icon{font-size:1.5rem;margin-right:10px}
    .free-delivery-banner p{font-size:1.1rem;font-weight:700;color:#92400e;margin:0}
    .payment-methods{display:flex;flex-direction:column;gap:15px}
    .payment-method{display:flex;align-items:center;gap:20px;background:linear-gradient(135deg,#f8fafc 0%,#ffffff 100%);border-radius:15px;padding:20px;border:2px solid rgba(45,106,79,0.1);transition:all .3s ease;position:relative}
    .payment-method:hover{transform:translateX(5px);border-color:rgba(45,106,79,0.3);box-shadow:0 8px 20px rgba(45,106,79,0.1)}
    .payment-method .payment-icon{font-size:2rem;background:linear-gradient(135deg,var(--brand-600) 0%,#22c55e 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 2px 5px rgba(45,106,79,0.2))}
    .payment-info{flex:1}
    .payment-info h4{font-size:1.2rem;font-weight:700;color:var(--brand-600);margin-bottom:5px}
    .payment-info p{font-size:0.95rem;color:var(--muted);margin:0;font-weight:500}
    .payment-status{width:30px;height:30px;background:linear-gradient(135deg,#16a34a 0%,#22c55e 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:900;font-size:1.2rem;box-shadow:0 4px 15px rgba(22,197,94,0.3)}

    @media (max-width:768px){.info-grid{grid-template-columns:1fr;gap:30px}.shipping-payment-section{margin:40px auto;padding:25px 20px}.section-header h2{font-size:2rem}.card-header{flex-direction:column;text-align:center;gap:10px}.payment-method{flex-direction:column;text-align:center;gap:15px}.zone-card,.payment-method{padding:15px}}

    /* Categories */
    .category{margin:40px 0}
    .category-title{font-weight:800;color:var(--brand-700);margin-bottom:20px;font-size:1.6rem;padding-bottom:10px;border-bottom:3px solid var(--brand-600);position:relative}
    .category-title::after{content:'';position:absolute;bottom:-3px;left:0;width:60px;height:3px;background:linear-gradient(135deg,#22c55e 0%,#16a34a 100%);border-radius:2px}

    /* Product grid - Enhanced Glassmorphism */
  .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;padding:20px 0}
  .product{background:linear-gradient(145deg,rgba(255,255,255,0.15) 0%,rgba(255,255,255,0.08) 50%,rgba(255,255,255,0.05) 100%);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:18px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:space-between;transition:all .5s cubic-bezier(0.175,0.885,0.32,1.275);box-shadow:0 15px 40px rgba(0,0,0,0.15),0 0 0 1px rgba(255,255,255,0.1),inset 0 1px 0 rgba(255,255,255,0.25),0 0 20px rgba(255,255,255,0.04);min-height:180px;border:1px solid rgba(255,255,255,0.2);position:relative;overflow:hidden}
    .product::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background-image:radial-gradient(circle at 20% 80%,rgba(120,119,198,0.1) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(255,119,198,0.1) 0%,transparent 50%),radial-gradient(circle at 40% 40%,rgba(120,219,226,0.1) 0%,transparent 50%);background-size:200px 200px,150px 150px,100px 100px;background-position:0% 0%,100% 100%,50% 50%;animation:backgroundFloat 20s ease-in-out infinite;border-radius:35px;pointer-events:none;opacity:0;transition:opacity .6s ease}
    .product:hover::before{opacity:1}
    .product:hover{transform:translateY(-20px) scale(1.05);box-shadow:0 40px 100px rgba(0,0,0,0.3),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.4),0 0 60px rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.3)}

  .product-image{width:100%;height:84px;object-fit:contain;border-radius:14px;background:linear-gradient(135deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);padding:8px;margin-bottom:8px;transition:all .4s ease;box-shadow:0 10px 28px rgba(0,0,0,0.18),0 0 0 1px rgba(255,255,255,0.1),inset 0 1px 0 rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.2)}
  .product:hover .product-image{transform:scale(1.08) rotate(2deg);box-shadow:0 20px 50px rgba(0,0,0,0.3),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
  .product h4{font-size:0.9rem;margin:6px 0 4px;text-align:center;color:#1f2937;font-weight:800;letter-spacing:0.2px;line-height:1.2;text-shadow:none}
  .product .price{color:white;font-weight:900;margin-bottom:8px;font-size:0.95rem;padding:8px 12px;background:linear-gradient(135deg,#ff6b6b 0%,#feca57 50%,#ff9ff3 100%);border-radius:28px;text-shadow:0 3px 8px rgba(0,0,0,0.35);box-shadow:0 6px 18px rgba(255,107,107,0.35),0 0 0 1px rgba(255,255,255,0.1),inset 0 1px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden;min-width:96px;text-align:center;letter-spacing:0.4px}
  .product .price::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .6s ease}
  .product:hover .price::before{left:100%}

  /* Overlay add toggle and compact controls */
  .product{position:relative}
  .add-toggle{position:absolute;top:8px;right:8px;width:36px;height:36px;border-radius:50%;border:none;background:linear-gradient(135deg,#16a34a,#22c55e);color:#fff;font-size:20px;font-weight:800;cursor:pointer;box-shadow:0 6px 16px rgba(34,197,94,0.35);z-index:3;transition:transform .2s ease}
  .add-toggle:active{transform:scale(0.95)}
  .product .product-controls{position:absolute;bottom:8px;right:8px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.92);border-radius:9999px;padding:6px 8px;box-shadow:0 10px 25px rgba(0,0,0,0.15);opacity:0;transform:scale(0.9);pointer-events:none;transition:all .25s ease;z-index:3}
  .product.controls-open .product-controls{opacity:1;transform:scale(1);pointer-events:auto}

    /* Recently bought */
    .recent-section{margin:12px 0 20px;padding:8px 6px}
    .recent-title{font-size:1rem;margin:0 0 8px;color:var(--brand-700);font-weight:700}
    .recent-list{display:flex;gap:10px;flex-wrap:nowrap;overflow:auto;padding-bottom:6px}
    .recent-item{min-width:140px;background:var(--card);border-radius:10px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 6px 18px rgba(3,8,6,0.04)}
    .recent-image{width:84px;height:64px;object-fit:cover;border-radius:8px;background:#fff}
    .recent-name{font-size:0.9rem;text-align:center;color:#072018;font-weight:700}
    .recent-price{font-size:0.85rem;color:var(--muted)}
    .recent-buy-btn{background:transparent;border:1px solid var(--brand-600);color:var(--brand-600);padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:700}

    .product-controls{display:flex;align-items:center;gap:6px}
    .product-quantity{min-width:32px;text-align:center;font-weight:800;font-size:1rem;color:#2c3e50;background:linear-gradient(135deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);padding:6px 10px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);box-shadow:0 4px 15px rgba(0,0,0,0.1),inset 0 2px 0 rgba(255,255,255,0.3)}

    .product-btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);color:#fff;border:none;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:16px;font-weight:bold;display:inline-flex;align-items:center;justify-content:center;transition:all .4s cubic-bezier(0.23,1,0.32,1);box-shadow:0 6px 20px rgba(102,126,234,0.4),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden}
    .product-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .5s ease}
    .product-btn:hover::before{left:100%}
    .product-btn:hover{transform:scale(1.15) translateY(-2px);box-shadow:0 8px 25px rgba(102,126,234,0.5),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
    .product-btn:active{transform:scale(.95)}

    /* Improved product card look when clicked (visual focus) */
    .product:focus-within,.product:focus{outline:3px solid rgba(45,106,79,0.12);box-shadow:0 12px 30px rgba(16,24,40,0.06)}

    /* Competitive E-commerce Features */
    .stock-badge{position:absolute;top:12px;left:12px;padding:8px 14px;border-radius:25px;font-size:0.75rem;font-weight:800;z-index:5;backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,0.3)}
    .stock-badge.in-stock{background:linear-gradient(135deg,#16a34a,#22c55e);color:white;box-shadow:0 2px 8px rgba(22,163,74,0.3)}
    .stock-badge.low-stock{background:linear-gradient(135deg,#f59e0b,#fbbf24);color:white;box-shadow:0 2px 8px rgba(245,158,11,0.3)}
    .stock-badge.out-of-stock{background:linear-gradient(135deg,#ef4444,#f87171);color:white;box-shadow:0 2px 8px rgba(239,68,68,0.3)}
    
    .delivery-badge{position:absolute;top:12px;right:12px;padding:8px 14px;border-radius:25px;font-size:0.75rem;font-weight:700;background:linear-gradient(135deg,#1e40af,#3b82f6,#60a5fa);color:white;z-index:5;backdrop-filter:blur(15px);box-shadow:0 4px 12px rgba(59,130,246,0.25);border:1px solid rgba(255,255,255,0.2)}
    
    .bulk-discount{font-size:0.8rem;color:#15803d;font-weight:700;margin:12px 0;padding:8px 14px;background:linear-gradient(135deg,#f0fdf4,#dcfce7,#bbf7d0);border-radius:20px;text-align:center;border:1px solid rgba(22,163,74,0.15);box-shadow:0 2px 8px rgba(22,163,74,0.08)}
    
    .quick-add-btn{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);color:white;border:none;padding:12px 24px;border-radius:30px;font-size:0.85rem;font-weight:700;cursor:pointer;opacity:0;transition:all 0.5s ease;z-index:10;box-shadow:0 6px 20px rgba(102,126,234,0.4),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1);position:relative;overflow:hidden}
    
    .quick-add-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .5s ease}
    
    .product:hover .quick-add-btn{opacity:1;transform:translateX(-50%) translateY(-12px) scale(1.02)}
    
    .quick-add-btn:hover{background:linear-gradient(135deg,#764ba2 0%,#f093fb 50%,#667eea 100%);transform:translateX(-50%) translateY(-16px) scale(1.08);box-shadow:0 8px 25px rgba(102,126,234,0.5),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
    
    .quick-add-btn:hover::before{left:100%}

  /* Modal - Enhanced Glassmorphism Popup */
  .modal{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,rgba(0,0,0,0.85),rgba(0,0,0,0.7));z-index:120;backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);
    opacity:0;visibility:hidden;transition:opacity .5s ease,visibility .5s ease;
  }
  .modal.show{opacity:1;visibility:visible}

  .modal-content{
    background:linear-gradient(145deg,rgba(255,255,255,0.15) 0%,rgba(255,255,255,0.08) 50%,rgba(255,255,255,0.05) 100%);
    backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);
    border-radius:35px;max-width:500px;width:94%;max-height:95vh;overflow-y:auto;position:relative;
    box-shadow:0 50px 150px rgba(0,0,0,0.6),0 0 0 2px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.3),0 0 60px rgba(255,255,255,0.05);
    transform:scale(0.7) translateY(60px) rotateX(10deg);opacity:0;
    transition:all .8s cubic-bezier(0.23,1,0.32,1);
    border:1px solid rgba(255,255,255,0.25);
    animation:modalGlowPulse 3s ease-in-out infinite 1s;
  }
  .modal.show .modal-content{transform:scale(1) translateY(0) rotateX(0deg);opacity:1}

  .modal-content::before{
    content:'';position:absolute;top:0;left:0;right:0;bottom:0;
    background-image:radial-gradient(circle at 20% 80%,rgba(120,119,198,0.1) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(255,119,198,0.1) 0%,transparent 50%),radial-gradient(circle at 40% 40%,rgba(120,219,226,0.1) 0%,transparent 50%);
    background-size:200px 200px,150px 150px,100px 100px;
    background-position:0% 0%,100% 100%,50% 50%;
    animation:backgroundFloat 20s ease-in-out infinite;
    border-radius:35px;pointer-events:none;
  }

  .modal-content:hover{
    box-shadow:0 60px 180px rgba(0,0,0,0.7),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.35),0 0 80px rgba(255,255,255,0.08);
    transform:scale(1.02) translateY(-5px) rotateX(0deg);
    animation-play-state:paused;
  }

  @keyframes modalGlowPulse{
    0%,100%{box-shadow:0 50px 150px rgba(0,0,0,0.6),0 0 0 2px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.3),0 0 60px rgba(255,255,255,0.05)}
    50%{box-shadow:0 60px 180px rgba(0,0,0,0.7),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.35),0 0 80px rgba(255,255,255,0.08)}
  }

  @keyframes backgroundFloat{
    0%,100%{background-position:0% 0%,100% 100%,50% 50%}
    25%{background-position:10% 10%,90% 90%,60% 40%}
    50%{background-position:20% 20%,80% 80%,70% 30%}
    75%{background-position:10% 10%,90% 90%,60% 40%}
  }

  .modal-body{padding:50px 35px 40px;text-align:center;display:flex;flex-direction:column;gap:30px;align-items:center;position:relative}
  .modal-image{width:180px;height:180px;object-fit:contain;border-radius:25px;flex-shrink:0;box-shadow:0 15px 40px rgba(0,0,0,0.3),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);transition:all .4s cubic-bezier(0.23,1,0.32,1);position:relative;overflow:hidden;background:linear-gradient(135deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:10px;border:1px solid rgba(255,255,255,0.2)}
  .modal-image::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .6s ease}
  .modal-image:hover::before{left:100%}
  .modal-image:hover{transform:scale(1.08) rotate(2deg);box-shadow:0 20px 50px rgba(0,0,0,0.4),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
  .modal-info{width:100%;text-align:center}
  .modal-info h3{color:#ffffff;font-size:2rem;margin-bottom:18px;font-weight:800;text-shadow:0 2px 10px rgba(0,0,0,0.3);background:linear-gradient(135deg,#ffffff 0%,#f0f8ff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:0.5px}
  .modal-info p{color:rgba(255,255,255,0.9);margin-bottom:25px;line-height:1.7;font-size:1.15rem;font-weight:500;text-shadow:0 1px 3px rgba(0,0,0,0.2)}
  .modal-price{color:white;font-size:1.6rem;font-weight:900;margin-bottom:30px;padding:15px 30px;background:linear-gradient(135deg,#ff6b6b 0%,#feca57 50%,#ff9ff3 100%);border-radius:35px;display:inline-block;text-shadow:0 3px 8px rgba(0,0,0,0.4);box-shadow:0 8px 25px rgba(255,107,107,0.4),0 0 0 2px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden;letter-spacing:0.5px}
  .modal-price::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .6s ease}
  .modal-price:hover::before{left:100%}

  .quantity-controls{display:flex;align-items:center;gap:25px;background:linear-gradient(135deg,rgba(255,255,255,0.15) 0%,rgba(255,255,255,0.08) 100%);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:18px 30px;border-radius:50px;box-shadow:0 8px 30px rgba(0,0,0,0.2),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.15);transition:all .3s ease;margin-bottom:30px}
  .quantity-controls:hover{box-shadow:0 12px 40px rgba(0,0,0,0.3),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3);transform:translateY(-2px)}
  .quantity-btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 50%,#f093fb 100%);color:white;border:none;width:50px;height:50px;border-radius:50%;cursor:pointer;font-size:22px;font-weight:bold;transition:all .3s cubic-bezier(0.23,1,0.32,1);box-shadow:0 6px 20px rgba(102,126,234,0.4),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden}
  .quantity-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:left .5s ease}
  .quantity-btn:hover::before{left:100%}
  .quantity-btn:hover{transform:scale(1.15) translateY(-2px);box-shadow:0 8px 25px rgba(102,126,234,0.5),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
  .quantity-display{width:90px;padding:15px;border:none;border-radius:20px;text-align:center;font-size:1.3rem;font-weight:bold;background:linear-gradient(135deg,rgba(255,255,255,0.9) 0%,rgba(255,255,255,0.7) 100%);backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);color:#2c3e50;box-shadow:0 4px 15px rgba(0,0,0,0.1),inset 0 2px 0 rgba(255,255,255,0.3);border:1px solid rgba(255,255,255,0.2);transition:all .3s ease}
  .quantity-display:focus{outline:none;box-shadow:0 6px 20px rgba(0,0,0,0.15),0 0 0 2px rgba(102,126,234,0.3),inset 0 2px 0 rgba(255,255,255,0.4);transform:scale(1.05)}

  .modal-buttons{display:flex;gap:20px;width:100%;justify-content:center;margin-top:35px;position:relative}
  .add-to-cart-btn{flex:1;padding:20px 35px;border-radius:50px;font-size:1.2rem;font-weight:800;cursor:pointer;transition:all .4s cubic-bezier(0.23,1,0.32,1);text-transform:uppercase;letter-spacing:1.5px;border:none;position:relative;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.2),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);background:linear-gradient(135deg,#00b894 0%,#00cec9 50%,#55efc4 100%);color:white}
  .add-to-cart-btn:hover{background:linear-gradient(135deg,#00cec9 0%,#55efc4 50%,#00b894 100%);transform:translateY(-5px) scale(1.02);box-shadow:0 15px 40px rgba(0,184,148,0.5),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
  .buy-now-btn{flex:1;padding:20px 35px;border-radius:50px;font-size:1.2rem;font-weight:800;cursor:pointer;transition:all .4s cubic-bezier(0.23,1,0.32,1);text-transform:uppercase;letter-spacing:1.5px;border:none;position:relative;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.2),0 0 0 1px rgba(255,255,255,0.1),inset 0 2px 0 rgba(255,255,255,0.2);background:linear-gradient(135deg,#ff6b6b 0%,#ee5a52 50%,#ff7675 100%);color:white}
  .buy-now-btn:hover{background:linear-gradient(135deg,#ee5a52 0%,#ff7675 50%,#ff6b6b 100%);transform:translateY(-5px) scale(1.02);box-shadow:0 15px 40px rgba(255,107,107,0.5),0 0 0 2px rgba(255,255,255,0.15),inset 0 2px 0 rgba(255,255,255,0.3)}
  .add-to-cart-btn::before,.buy-now-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left .5s ease}
  .add-to-cart-btn:hover::before,.buy-now-btn:hover::before{left:100%}

  /* Close button */
  .modal .close{position:absolute;top:20px;right:25px;background:linear-gradient(135deg,#ff6b6b,#ee5a52);border:none;font-size:20px;font-weight:bold;cursor:pointer;color:white;width:45px;height:45px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s ease;box-shadow:0 5px 15px rgba(255,107,107,0.4)}
  .modal .close:hover{background:linear-gradient(135deg,#ee5a52,#ff6b6b);transform:rotate(90deg) scale(1.1);box-shadow:0 8px 25px rgba(255,107,107,0.6)}

  /* Affirmative action small icon button (check) */
  .confirm-icon{display:inline-flex;align-items:center;justify-content:center;width:54px;height:44px;border-radius:28px;background:linear-gradient(180deg,var(--brand-600),#1e8c57);color:white;border:none;box-shadow:0 10px 30px rgba(45,106,79,0.18);font-size:18px}

    /* Toast */
    .toast{position:fixed;right:24px;bottom:30px;background:linear-gradient(90deg,var(--brand-600),#56c39f);color:white;padding:12px 18px;border-radius:999px;box-shadow:0 8px 30px rgba(3,8,6,0.12);z-index:9999;font-weight:700}

    /* Loading screen */
    #loading-screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#e6f0ff,#e6fff3);z-index:9999}
    .loading-logo{width:74px;height:74px;border-radius:50%;background:url('logo.jpg') center/cover}

    /* Utility */
    .hidden{display:none !important}

  /* Cookie consent banner */
  .cookie-banner{position:fixed;left:20px;right:20px;bottom:20px;background:linear-gradient(90deg,#ffffff,#f7fff7);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:12px;box-shadow:0 18px 40px rgba(3,8,6,0.12);z-index:99999;max-width:1100px;margin:0 auto;justify-content:space-between}
  .cookie-banner .cookie-text{flex:1;color:#083322;font-size:0.95rem}
  .cookie-banner .cookie-actions{display:flex;gap:8px;align-items:center}
  .cookie-btn{background:var(--brand-600);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .cookie-link{background:transparent;border:1px solid rgba(6,34,20,0.06);padding:8px 12px;border-radius:8px;cursor:pointer;color:var(--brand-600);font-weight:700}

  /* Cookie manage modal */
  .cookie-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%) scale(.98);background:#fff;border-radius:12px;padding:18px;box-shadow:0 30px 60px rgba(3,8,6,0.18);z-index:100000;max-width:520px;width:94%;opacity:0;visibility:hidden;transition:opacity .18s ease,transform .18s ease}
  .cookie-modal.show{opacity:1;visibility:visible;transform:translate(-50%,-50%) scale(1)}
  .cookie-modal h4{margin:0 0 10px}
  .cookie-toggle{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-top:1px solid #eef6f0}
  .cookie-toggle:first-of-type{border-top:0}
  .cookie-small{font-size:0.9rem;color:var(--muted)}

  @media (max-width:900px){.modal-content{flex-direction:column;align-items:center}.modal-image{width:80%;height:180px}}
  @media (max-width:480px){
    .products{grid-template-columns:repeat(2,1fr);gap:8px}
    .product-image{height:90px}
    .product{min-height:200px;padding:8px}
    .stock-badge,.delivery-badge{font-size:0.65rem;padding:2px 6px}
    .bulk-discount{font-size:0.7rem;margin:4px 0}
    .quick-add-btn{font-size:0.75rem;padding:6px 12px}
    .product h4{font-size:0.8rem;margin:6px 0 4px}
    .product .price{font-size:0.9rem;margin-bottom:4px}
    .product-controls{gap:4px}
    .product-btn{width:32px;height:32px;font-size:16px}
    .product-quantity{min-width:24px;font-size:0.9rem}
    .shop-section{margin:16px auto;padding:12px}
    .shop-section h2{font-size:1.6rem;margin:0 0 8px}
    .category-title{font-size:1rem;margin-bottom:6px}
    .recent-section{margin:8px 0 16px;padding:6px 4px}
    .recent-title{font-size:0.9rem;margin:0 0 6px}
    .recent-list{gap:8px;padding-bottom:4px}
    .recent-item{min-width:120px;padding:6px}
    .recent-image{width:72px;height:56px}
    .recent-name{font-size:0.8rem}
    .recent-price{font-size:0.75rem}
    .modal-content{max-width:95%;width:95%;padding:20px 20px}
    .modal-image{width:160px;height:120px}
    .modal-info h3{font-size:1.4rem}
    .modal-price{font-size:0.95rem}
    .quantity-controls{gap:10px;margin-top:6px}
    .quantity-btn{padding:10px 12px;font-size:16px}
    .quantity-display{min-width:24px;font-size:0.95rem}
    .add-to-cart-btn,.buy-now-btn{padding:10px 18px;font-size:14px}
  }
  </style>
</head>
<body>
  <div id="navbar-container"></div>

  <section class="shop-section">
    <h2>Fresh Farm Produce</h2>
    <!-- Enhanced Filters -->
    <div class="filters-container">
      <div class="search-filter">
        <input type="text" id="search-bar" placeholder="ðŸ” Search products..." class="search-input-modern">
        <button id="search-btn" class="search-btn-modern">Search</button>
      </div>
      <div class="price-filter">
        <label for="price-filter" class="filter-label">ðŸ’° Filter by Price:</label>
        <select id="price-filter" class="price-select-modern">
          <option value="all">All Prices</option>
          <option value="under-50">Under KES 50</option>
          <option value="50-100">KES 50 - 100</option>
          <option value="100-200">KES 100 - 200</option>
          <option value="over-200">Over KES 200</option>
        </select>
      </div>
    </div>
    <!-- Recently bought (persisted in localStorage) -->
    <div class="recent-section">
      <h3 class="recent-title">Recently Bought</h3>
      <div class="recent-list" id="recent-list" aria-live="polite"></div>
    </div>
    
    <!-- Category: Animal & Farm Produce -->
    <div class="category">
      <h3 class="category-title">Animal & Farm Produce</h3>
      <div class="products animal-farm">
  <div class="product" data-name="Fresh Milk" data-description="Pure, fresh milk from our farm." data-image="milk.png" data-price="120"><div class="stock-badge in-stock">âœ“ In Stock</div><div class="delivery-badge">ðŸšš Same Day</div><img src="milk.png" alt="Fresh Milk" class="product-image"><h4>Fresh Milk</h4><p class="price" data-price="120">KES 120 / liter</p><div class="bulk-discount">ðŸ’° Buy 5+ get 10% off</div><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Fresh Milk">âˆ’</button><span class="product-quantity" id="qty-Fresh-Milk">0</span><button class="product-btn" data-action="add" data-name="Fresh Milk" data-price="120" data-image="milk.png">+</button></div><button class="quick-add-btn" onclick="quickAddToCart('Fresh Milk', 120, 'milk.png')">Quick Add</button></div>
  <div class="product" data-name="Free-Range Chicken" data-description="Healthy, free-range chicken." data-image="chicken.png" data-price="800"><img src="chicken.png" alt="Free-Range Chicken" class="product-image"><h4>Free-Range Chicken</h4><p class="price" data-price="800">KES 800 / kg</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Free-Range Chicken">âˆ’</button><span class="product-quantity" id="qty-Free-Range-Chicken">0</span><button class="product-btn" data-action="add" data-name="Free-Range Chicken" data-price="800" data-image="chicken.png">+</button></div></div>
  <div class="product" data-name="Farm Fresh Eggs" data-description="Fresh eggs from free-range chickens." data-image="eggs.png" data-price="25"><img src="eggs.png" alt="Farm Fresh Eggs" class="product-image"><h4>Farm Fresh Eggs</h4><p class="price" data-price="25">KES 25 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Farm Fresh Eggs">âˆ’</button><span class="product-quantity" id="qty-Farm-Fresh-Eggs">0</span><button class="product-btn" data-action="add" data-name="Farm Fresh Eggs" data-price="25" data-image="eggs.png">+</button></div></div>
  <div class="product" data-name="Pure Ghee" data-description="Traditional clarified butter." data-image="ghee.png" data-price="600"><img src="ghee.png" alt="Pure Ghee" class="product-image"><h4>Pure Ghee</h4><p class="price" data-price="600">KES 600 / 500g</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pure Ghee">âˆ’</button><span class="product-quantity" id="qty-Pure-Ghee">0</span><button class="product-btn" data-action="add" data-name="Pure Ghee" data-price="600" data-image="ghee.png">+</button></div></div>
  <div class="product" data-name="Honey" data-description="Pure, natural honey from local beekeepers." data-image="honey.png" data-price="400"><img src="honey.png" alt="Honey" class="product-image"><h4>Honey</h4><p class="price" data-price="400">KES 400 / 500g</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Honey">âˆ’</button><span class="product-quantity" id="qty-Honey">0</span><button class="product-btn" data-action="add" data-name="Honey" data-price="400" data-image="honey.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Fruits -->
    <div class="category">
      <h3 class="category-title">Fruits</h3>
      <div class="products">
  <div class="product" data-name="Bananas" data-description="Fresh bananas, perfect for snacking." data-image="bananas-ripe.png" data-price="150"><div class="stock-badge in-stock">âœ“ In Stock</div><div class="delivery-badge">ðŸšš Same Day</div><img src="bananas-ripe.png" alt="Bananas" class="product-image"><h4>Bananas</h4><p class="price" data-price="150">KES 150 / bunch</p><div class="bulk-discount">ðŸ’° Buy 3+ get 5% off</div><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Bananas">âˆ’</button><span class="product-quantity" id="qty-Bananas">0</span><button class="product-btn" data-action="add" data-name="Bananas" data-price="150" data-image="bananas-ripe.png">+</button></div><button class="quick-add-btn" onclick="quickAddToCart('Bananas', 150, 'bananas-ripe.png')">Quick Add</button></div>
  <div class="product" data-name="Oranges" data-description="Juicy oranges, rich in vitamin C." data-image="oranges.png" data-price="200"><img src="oranges.png" alt="Oranges" class="product-image"><h4>Oranges</h4><p class="price" data-price="200">KES 200 / kg</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Oranges">âˆ’</button><span class="product-quantity" id="qty-Oranges">0</span><button class="product-btn" data-action="add" data-name="Oranges" data-price="200" data-image="oranges.png">+</button></div></div>

  <div class="product" data-name="Watermelon" data-description="Sweet watermelon, perfect for hot days." data-image="watermelon.png" data-price="250"><img src="watermelon.png" alt="Watermelon" class="product-image"><h4>Watermelon</h4><p class="price" data-price="250">KES 250 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Watermelon">âˆ’</button><span class="product-quantity" id="qty-Watermelon">0</span><button class="product-btn" data-action="add" data-name="Watermelon" data-price="250" data-image="watermelon.png">+</button></div></div>
  <div class="product" data-name="Mangoes" data-description="Juicy mangoes, perfect for summer." data-image="mangoes.png" data-price="40"><img src="mangoes.png" alt="Mangoes" class="product-image"><h4>Mangoes</h4><p class="price" data-price="40">KES 40 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Mangoes">âˆ’</button><span class="product-quantity" id="qty-Mangoes">0</span><button class="product-btn" data-action="add" data-name="Mangoes" data-price="40" data-image="mangoes.png">+</button></div></div>
  <div class="product" data-name="Lemon" data-description="Fresh lemons for cooking and drinks." data-image="lemon.png" data-price="20"><img src="lemon.png" alt="Lemon" class="product-image"><h4>Lemon</h4><p class="price" data-price="20">KES 20 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Lemon">âˆ’</button><span class="product-quantity" id="qty-Lemon">0</span><button class="product-btn" data-action="add" data-name="Lemon" data-price="20" data-image="lemon.png">+</button></div></div>
  <div class="product" data-name="Pawpaw" data-description="Sweet pawpaw fruit, rich in vitamins." data-image="pawpaw.png" data-price="120"><img src="pawpaw.png" alt="Pawpaw" class="product-image"><h4>Pawpaw</h4><p class="price" data-price="120">KES 120 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pawpaw">âˆ’</button><span class="product-quantity" id="qty-Pawpaw">0</span><button class="product-btn" data-action="add" data-name="Pawpaw" data-price="120" data-image="pawpaw.png">+</button></div></div>
  <div class="product" data-name="Pixies" data-description="Mini sweet oranges, great for snacking." data-image="pixies.png" data-price="35"><img src="pixies.png" alt="Pixies" class="product-image"><h4>Pixies</h4><p class="price" data-price="35">KES 35 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Pixies">âˆ’</button><span class="product-quantity" id="qty-Pixies">0</span><button class="product-btn" data-action="add" data-name="Pixies" data-price="35" data-image="pixies.png">+</button></div></div>
  <div class="product" data-name="Avocadoes" data-description="Creamy avocados for healthy eating." data-image="avocadoes.png" data-price="30"><img src="avocadoes.png" alt="Avocadoes" class="product-image"><h4>Avocadoes</h4><p class="price" data-price="30">KES 30 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Avocadoes">âˆ’</button><span class="product-quantity" id="qty-Avocadoes">0</span><button class="product-btn" data-action="add" data-name="Avocadoes" data-price="30" data-image="avocadoes.png">+</button></div></div>
  <div class="product" data-name="Yellow Passion" data-description="Tangy passion fruit for juices." data-image="yellow-passion.png" data-price="25"><img src="yellow-passion.png" alt="Yellow Passion" class="product-image"><h4>Yellow Passion</h4><p class="price" data-price="25">KES 25 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Yellow Passion">âˆ’</button><span class="product-quantity" id="qty-Yellow-Passion">0</span><button class="product-btn" data-action="add" data-name="Yellow Passion" data-price="25" data-image="yellow-passion.png">+</button></div></div>
  <div class="product" data-name="Kiwi" data-description="Nutritious kiwi fruit, full of vitamin C." data-image="kiwi.png" data-price="60"><img src="kiwi.png" alt="Kiwi" class="product-image"><h4>Kiwi</h4><p class="price" data-price="60">KES 60 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kiwi">âˆ’</button><span class="product-quantity" id="qty-Kiwi">0</span><button class="product-btn" data-action="add" data-name="Kiwi" data-price="60" data-image="kiwi.png">+</button></div></div>
  <div class="product" data-name="Raw Bananas" data-description="Green bananas for cooking." data-image="raw-bananas.png" data-price="100"><img src="raw-bananas.png" alt="Raw Bananas" class="product-image"><h4>Raw Bananas</h4><p class="price" data-price="100">KES 100 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Raw Bananas">âˆ’</button><span class="product-quantity" id="qty-Raw-Bananas">0</span><button class="product-btn" data-action="add" data-name="Raw Bananas" data-price="100" data-image="raw-bananas.png">+</button></div></div>
  <div class="product" data-name="Dragon Fruit" data-description="Exotic dragon fruit, sweet and nutritious." data-image="dragonfruit.png" data-price="300"><img src="dragonfruit.png" alt="Dragon Fruit" class="product-image"><h4>Dragon Fruit</h4><p class="price" data-price="300">KES 300 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Dragon Fruit">âˆ’</button><span class="product-quantity" id="qty-Dragon-Fruit">0</span><button class="product-btn" data-action="add" data-name="Dragon Fruit" data-price="300" data-image="dragonfruit.png">+</button></div></div>
  <div class="product" data-name="Soursop" data-description="Tropical soursop fruit, great for juices." data-image="soursop.png" data-price="250"><img src="soursop.png" alt="Soursop" class="product-image"><h4>Soursop</h4><p class="price" data-price="250">KES 250 / piece</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Soursop">âˆ’</button><span class="product-quantity" id="qty-Soursop">0</span><button class="product-btn" data-action="add" data-name="Soursop" data-price="250" data-image="soursop.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Herbs -->
    <div class="category">
      <h3 class="category-title">Herbs</h3>
      <div class="products">
  <div class="product" data-name="Basil" data-description="Fresh basil leaves for cooking." data-image="basil.png" data-price="50"><img src="basil.png" alt="Basil" class="product-image"><h4>Basil</h4><p class="price" data-price="50">KES 50 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Basil">âˆ’</button><span class="product-quantity" id="qty-Basil">0</span><button class="product-btn" data-action="add" data-name="Basil" data-price="50" data-image="basil.png">+</button></div></div>
  <div class="product" data-name="Coriander" data-description="Aromatic coriander leaves and seeds." data-image="coriander.png" data-price="30"><img src="coriander.png" alt="Coriander" class="product-image"><h4>Coriander</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Coriander">âˆ’</button><span class="product-quantity" id="qty-Coriander">0</span><button class="product-btn" data-action="add" data-name="Coriander" data-price="30" data-image="coriander.png">+</button></div></div>
  <div class="product" data-name="Mint" data-description="Fresh mint leaves for cooking and drinks." data-image="mint.png" data-price="40"><img src="mint.png" alt="Mint" class="product-image"><h4>Mint</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Mint">âˆ’</button><span class="product-quantity" id="qty-Mint">0</span><button class="product-btn" data-action="add" data-name="Mint" data-price="40" data-image="mint.png">+</button></div></div>
  <div class="product" data-name="Parsley" data-description="Fresh parsley leaves for cooking." data-image="parsley.png" data-price="35"><img src="parsley.png" alt="Parsley" class="product-image"><h4>Parsley</h4><p class="price" data-price="35">KES 35 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Parsley">âˆ’</button><span class="product-quantity" id="qty-Parsley">0</span><button class="product-btn" data-action="add" data-name="Parsley" data-price="35" data-image="parsley.png">+</button></div></div>
  <div class="product" data-name="Soursop Leaves" data-description="Medicinal soursop leaves." data-image="soursop-herbs.png" data-price="200"><img src="soursop-herbs.png" alt="Soursop Leaves" class="product-image"><h4>Soursop Leaves</h4><p class="price" data-price="200">from KES 200</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Soursop Leaves">âˆ’</button><span class="product-quantity" id="qty-Soursop-Leaves">0</span><button class="product-btn" data-action="add" data-name="Soursop Leaves" data-price="200" data-image="soursop-herbs.png">+</button></div></div>
      </div>
    </div>

    <!-- Category: Vegetables & Greens -->
    <div class="category">
      <h3 class="category-title">Vegetables & Greens</h3>
      <div class="products">
  <div class="product" data-name="Kales (Sukuma Wiki)" data-description="Nutritious kales, perfect for sukuma wiki." data-image="kales.png" data-price="30"><div class="stock-badge low-stock">âš ï¸ Low Stock</div><div class="delivery-badge">ðŸšš Same Day</div><img src="kales.png" alt="Kales (Sukuma Wiki)" class="product-image"><h4>Kales (Sukuma Wiki)</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="bulk-discount">ðŸ’° Buy 10+ get 15% off</div><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kales (Sukuma Wiki)">âˆ’</button><span class="product-quantity" id="qty-Kales-(Sukuma-Wiki)">0</span><button class="product-btn" data-action="add" data-name="Kales (Sukuma Wiki)" data-price="30" data-image="kales.png">+</button></div><button class="quick-add-btn" onclick="quickAddToCart('Kales (Sukuma Wiki)', 30, 'kales.png')">Quick Add</button></div>
  <div class="product" data-name="Lettuce" data-description="Fresh, crisp lettuce for salads." data-image="lettuce.png" data-price="80"><img src="lettuce.png" alt="Lettuce" class="product-image"><h4>Lettuce</h4><p class="price" data-price="80">KES 80 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Lettuce">âˆ’</button><span class="product-quantity" id="qty-Lettuce">0</span><button class="product-btn" data-action="add" data-name="Lettuce" data-price="80" data-image="lettuce.png">+</button></div></div>
  <div class="product" data-name="Managu" data-description="Traditional African vegetable." data-image="managu.png" data-price="40"><img src="managu.png" alt="Managu" class="product-image"><h4>Managu</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Managu">âˆ’</button><span class="product-quantity" id="qty-Managu">0</span><button class="product-btn" data-action="add" data-name="Managu" data-price="40" data-image="managu.png">+</button></div></div>
  <div class="product" data-name="Terere" data-description="Fresh terere leaves for cooking." data-image="terere.png" data-price="40"><img src="terere.png" alt="Terere" class="product-image"><h4>Terere</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Terere">âˆ’</button><span class="product-quantity" id="qty-Terere">0</span><button class="product-btn" data-action="add" data-name="Terere" data-price="40" data-image="terere.png">+</button></div></div>
  <div class="product" data-name="Salgaa" data-description="Fresh salgaa for traditional dishes." data-image="salgaa.png" data-price="20"><img src="salgaa.png" alt="Salgaa" class="product-image"><h4>Salgaa</h4><p class="price" data-price="20">KES 20 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Salgaa">âˆ’</button><span class="product-quantity" id="qty-Salgaa">0</span><button class="product-btn" data-action="add" data-name="Salgaa" data-price="20" data-image="salgaa.png">+</button></div></div>
  <div class="product" data-name="Spinach" data-description="Fresh spinach leaves, rich in iron." data-image="spinach.png" data-price="30"><img src="spinach.png" alt="Spinach" class="product-image"><h4>Spinach</h4><p class="price" data-price="30">KES 30 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Spinach">âˆ’</button><span class="product-quantity" id="qty-Spinach">0</span><button class="product-btn" data-action="add" data-name="Spinach" data-price="30" data-image="spinach.png">+</button></div></div>
  <div class="product" data-name="Cauliflower" data-description="Fresh cauliflower, perfect for healthy meals." data-image="cauliflower.png" data-price="80"><img src="cauliflower.png" alt="Cauliflower" class="product-image"><h4>Cauliflower</h4><p class="price" data-price="80">KES 80 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Cauliflower">âˆ’</button><span class="product-quantity" id="qty-Cauliflower">0</span><button class="product-btn" data-action="add" data-name="Cauliflower" data-price="80" data-image="cauliflower.png">+</button></div></div>
  <div class="product" data-name="Broccoli" data-description="Nutritious broccoli, rich in vitamins." data-image="broccoli.png" data-price="70"><img src="broccoli.png" alt="Broccoli" class="product-image"><h4>Broccoli</h4><p class="price" data-price="70">KES 70 / head</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Broccoli">âˆ’</button><span class="product-quantity" id="qty-Broccoli">0</span><button class="product-btn" data-action="add" data-name="Broccoli" data-price="70" data-image="broccoli.png">+</button></div></div>
  <div class="product" data-name="Kunde" data-description="Fresh kunde leaves for traditional dishes." data-image="kunde.png" data-price="40"><img src="kunde.png" alt="Kunde" class="product-image"><h4>Kunde</h4><p class="price" data-price="40">KES 40 / bunch</p><div class="product-controls"><button class="product-btn" data-action="remove" data-name="Kunde">âˆ’</button><span class="product-quantity" id="qty-Kunde">0</span><button class="product-btn" data-action="add" data-name="Kunde" data-price="40" data-image="kunde.png">+</button></div></div>
      </div>
    </div>
  </section>

  <!-- Enhanced Shipping & Payment Info -->
  <section class="shipping-payment-section">
    <div class="section-header">
      <h2>ðŸšš Shipping & Payment</h2>
      <p>Fast delivery and secure payment options</p>
    </div>
    
    <div class="info-grid">
      <div class="shipping-card">
        <div class="card-header">
          <span class="card-icon">ðŸš›</span>
          <h3>Delivery Zones & Prices</h3>
        </div>
        <div class="delivery-zones">
          <div class="zone-card">
            <div class="zone-info">
              <h4>ðŸ™ï¸ Nairobi</h4>
              <p class="zone-price">KES 200</p>
              <span class="zone-time">Same day delivery</span>
            </div>
          </div>
          <div class="zone-card">
            <div class="zone-info">
              <h4>ðŸŒ† Kiambu</h4>
              <p class="zone-price">KES 150</p>
              <span class="zone-time">Next day delivery</span>
            </div>
          </div>
          <div class="zone-card">
            <div class="zone-info">
              <h4>ðŸŒ Other Areas</h4>
              <p class="zone-price">KES 300</p>
              <span class="zone-time">2-3 days delivery</span>
            </div>
          </div>
        </div>
        <div class="free-delivery-banner">
          <span class="banner-icon">ðŸŽ‰</span>
          <p>Free delivery on orders over KES 2000!</p>
        </div>
      </div>
      
      <div class="payment-card">
        <div class="card-header">
          <span class="card-icon">ðŸ’³</span>
          <h3>Payment Methods</h3>
        </div>
        <div class="payment-methods">
          <div class="payment-method">
            <span class="payment-icon">ðŸ“±</span>
            <div class="payment-info">
              <h4>M-Pesa</h4>
              <p>Pay with your mobile money</p>
            </div>
            <div class="payment-status">âœ“</div>
          </div>
          <div class="payment-method">
            <span class="payment-icon">ðŸ’³</span>
            <div class="payment-info">
              <h4>Credit/Debit Card</h4>
              <p>Secure online payments</p>
            </div>
            <div class="payment-status">âœ“</div>
          </div>
          <div class="payment-method">
            <span class="payment-icon">ðŸ¦</span>
            <div class="payment-info">
              <h4>Bank Transfer</h4>
              <p>Direct bank payments</p>
            </div>
            <div class="payment-status">âœ“</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Product Modal -->
  <div id="product-modal" class="modal">
    <div class="modal-content">
      <button class="close">&times;</button>
      <div class="modal-body">
        <img id="modal-image" src="" alt="" class="modal-image">
        <div class="modal-info">
          <h3 id="modal-title"></h3>
          <p id="modal-description"></p>
          <div id="modal-details" class="modal-details"></div>
          <div id="modal-price" class="modal-price"></div>
          <div class="quantity-selector">
            <label for="quantity">Select Quantity</label>
            <div class="quantity-controls">
                <button type="button" class="quantity-btn" data-action="decrease">âˆ’</button>
                <input type="number" id="quantity" min="1" value="1" readonly>
                <button type="button" class="quantity-btn" data-action="increase">+</button>
              </div>
          </div>
          <div class="modal-buttons">
            <button id="add-to-cart-btn" class="add-to-cart-btn">ðŸ›’ Add to Cart</button>
            <button id="buy-now-btn" class="buy-now-btn">âš¡ Buy Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 TillValle. All rights reserved.</p>
  </footer>

  <!-- Cookie consent banner -->
  <div id="cookie-consent" class="cookie-banner hidden" role="dialog" aria-live="polite">
    <div class="cookie-text">We use cookies to improve your experience. Some are required for site functionality. By clicking "Accept All" you agree to our use of analytics and marketing cookies. <a href="privacy.html" style="color:var(--brand-600);font-weight:700;text-decoration:underline;margin-left:6px">Privacy policy</a></div>
    <div class="cookie-actions">
      <button id="cookie-decline" class="cookie-link">Decline Non-Essential</button>
      <button id="cookie-manage" class="cookie-link">Manage</button>
      <button id="cookie-accept" class="cookie-btn">Accept All</button>
    </div>
  </div>

  <!-- Cookie manage modal -->
  <div id="cookie-modal" class="cookie-modal" aria-hidden="true">
    <h4>Cookie preferences</h4>
    <div class="cookie-small">Toggle which cookies you allow. Necessary cookies are always enabled.</div>
    <div class="cookie-toggle" data-key="necessary">
      <div>
        <strong>Necessary</strong>
        <div class="cookie-small">Required for core site functionality.</div>
      </div>
      <div><input type="checkbox" disabled checked></div>
    </div>
    <div class="cookie-toggle" data-key="analytics">
      <div>
        <strong>Analytics</strong>
        <div class="cookie-small">Helps us understand site usage (optional).</div>
      </div>
      <div><input type="checkbox" id="cookie-analytics"></div>
    </div>
    <div class="cookie-toggle" data-key="marketing">
      <div>
        <strong>Marketing</strong>
        <div class="cookie-small">Used for personalized offers (optional).</div>
      </div>
      <div><input type="checkbox" id="cookie-marketing"></div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="cookie-save" class="cookie-btn">Save preferences</button>
      <button id="cookie-cancel" class="cookie-link">Cancel</button>
    </div>
  </div>

  <!-- Chatbot Sidebar -->
  <div class="chatbot-sidebar" id="chatbot-sidebar">
    <div class="chatbot-header">
      <span>ðŸ¤– TillieBot</span>
      <button class="chatbot-close" id="chatbot-close">&times;</button>
    </div>
    <div class="chatbot-messages" id="chatbot-messages">
      <div class="chatbot-message bot">
        ðŸŒ± Hello! Welcome to TillValle! I'm TillieBot, your smart farming assistant. How can I help you today?
      </div>
    </div>
    <div class="chatbot-input-area">
      <div class="chatbot-input-container">
        <input type="text" id="chatbot-input" placeholder="Ask me about products, delivery, or stock..." class="chatbot-input">
        <button id="chatbot-send" class="chatbot-send">ðŸ“¤</button>
      </div>
    </div>
  </div>

  <!-- Chatbot Backdrop -->
  <div class="chatbot-backdrop" id="chatbot-backdrop"></div>



  <script>
    // Load navbar
    fetch('navbar.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('navbar-container').innerHTML = data;
        // Load navbar-universal.js after navbar is loaded
        const script = document.createElement('script');
        script.src = 'navbar-universal.js';
        script.onload = function() {
          if (typeof initNavbar === 'function') {
            initNavbar();
          }
        };
        document.head.appendChild(script);
    });

    // Product modal functionality
    let modalCurrentProduct = {};

    function openProductModal(name, description, image, price) {
      modalCurrentProduct = { name, description, image, price };
      
      document.getElementById('modal-title').textContent = name;
      document.getElementById('modal-description').textContent = description;
      document.getElementById('modal-price').textContent = 'KES ' + price;
      document.getElementById('modal-image').src = image;
      document.getElementById('modal-image').alt = name;
      document.getElementById('quantity').value = 1;
      
      const modal = document.getElementById('product-modal');
      modal.style.display = 'flex';
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
      const modal = document.getElementById('product-modal');
      modal.style.display = 'none';
      modal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }
    
    window.closeModal = closeModal;
    
  // Close modal (defensive)
  const closeBtn = document.querySelector('.close');
  if (closeBtn) closeBtn.addEventListener('click', closeModal);
    
    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('product-modal');
      if (event.target === modal) {
        closeModal();
      }
    };
    
    // Quantity controls (unobtrusive). Attach listeners instead of inline onclicks.
    (function() {
      const modal = document.getElementById('product-modal');

      // Modal-level quantity buttons (increase/decrease)
      if (modal) {
        modal.addEventListener('click', function(e) {
          const btn = e.target.closest('.quantity-btn');
          if (!btn) return;
          const action = btn.dataset.action;
          const input = document.getElementById('quantity');
          if (!input) return;
          let v = parseInt(input.value, 10) || 1;
          if (action === 'increase') v++;
          else if (action === 'decrease' && v > 1) v--;
          input.value = v;
        });
      }

      // Delegated product grid handlers: + / - buttons and product click to open modal
      document.addEventListener('click', function(e) {
        const control = e.target.closest('.product-btn');
        if (control) {
          const action = control.dataset.action;
          const product = control.closest('.product');
          if (!product) return;
          
          // Check if user is logged in
          if (!localStorage.getItem('email')) {
            showToast('Please log in to add items to cart', true);
            setTimeout(() => window.location.href = 'login.html', 2000);
            return;
          }
          
          const name = control.dataset.name || product.dataset.name;
          const price = parseFloat(control.dataset.price || product.dataset.price || 0);
          const image = control.dataset.image || product.dataset.image || '';
          
          if (action === 'add') {
            addToCart(name, price, image);
          } else if (action === 'remove') {
            removeFromCart(name);
          }
          return; // handled
        }

        // redirect to product details page when clicking a product (but ignore clicks inside controls)
        const productCard = e.target.closest('.product');
        if (productCard && !e.target.closest('.product-controls')) {
          const name = productCard.dataset.name || '';
          const desc = productCard.dataset.description || '';
          const img = productCard.dataset.image || productCard.querySelector('.product-image')?.src || '';
          const price = productCard.dataset.price || productCard.querySelector('.price')?.dataset.price || '';
          const url = `product.html?name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}&image=${encodeURIComponent(img)}&description=${encodeURIComponent(desc)}`;
          window.location.href = url;
        }
      });
    })();
    
    // Cart management
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }
    
    function addToCart(name, price, image) {
      if (!localStorage.getItem('email')) {
        showToast('Please log in to add items to cart', true);
        setTimeout(() => window.location.href = 'login.html', 2000);
        return;
      }
      
      const existingItem = cart.find(item => item.name === name);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ name, price, quantity: 1, image });
      }
      saveCart();
      updateProductQuantityDisplay(name);
      showToast(`${name} added to cart!`);
    }
    
    function removeFromCart(name) {
      if (!localStorage.getItem('email')) {
        showToast('Please log in to manage cart', true);
        return;
      }
      
      const existingItem = cart.find(item => item.name === name);
      if (existingItem) {
        if (existingItem.quantity > 1) {
          existingItem.quantity--;
        } else {
          cart = cart.filter(item => item.name !== name);
        }
        saveCart();
        updateProductQuantityDisplay(name);
        showToast(`${name} quantity decreased!`);
      }
    }
    
    function updateProductQuantityDisplay(name) {
      const qtyElement = document.getElementById(`qty-${name.replace(/[^a-zA-Z0-9]+/g, '-')}`);
      if (qtyElement) {
        const existingItem = cart.find(item => item.name === name);
        qtyElement.textContent = existingItem ? existingItem.quantity : 0;
      }
    }
    
    // Initialize cart display
    function initCartDisplay() {
      const products = document.querySelectorAll('.product');
      products.forEach(product => {
        const name = product.dataset.name;
        if (name) updateProductQuantityDisplay(name);
      });
    }
    
    // Add to cart functionality
    const addToCartBtn = document.getElementById('add-to-cart-btn');
    if (addToCartBtn) addToCartBtn.addEventListener('click', function() {
      if (!localStorage.getItem('email')) {
        showToast('Please log in to add items to cart', true);
        setTimeout(() => window.location.href = 'login.html', 2000);
        return;
      }
      
      const quantity = parseInt(document.getElementById('quantity').value);
      if (quantity > 0) {
        for (let i = 0; i < quantity; i++) {
          addToCart(modalCurrentProduct.name, modalCurrentProduct.price, modalCurrentProduct.image);
        }
        
        // Persist as a recent purchase
        try {
          saveRecentPurchase(modalCurrentProduct, quantity);
          renderRecentPurchases();
        } catch (e) {
          console.warn('Could not save recent purchase', e);
        }

        // Add animation to button
        const btn = this;
        btn.style.transform = 'scale(0.95)';
        btn.textContent = 'âœ“ Added!';
        
        setTimeout(() => {
          btn.style.transform = 'scale(1)';
          btn.textContent = 'ðŸ›’ Add to Cart';
          closeModal();
        }, 1000);
      }
    });

    // Recent purchases: storage & rendering
    function getRecentPurchases() {
      try {
        const raw = localStorage.getItem('tillvalle_recent_purchases');
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        return [];
      }
    }

    function saveRecentPurchase(product, quantity) {
      if (!product || !product.name) return;
      const list = getRecentPurchases();
      const entry = {
        name: product.name,
        image: product.image || '',
        price: product.price || product.price === 0 ? product.price : (product.price || ''),
        qty: quantity || 1,
        ts: Date.now()
      };

      // Remove any previous entry with same name
      const filtered = list.filter(it => it.name !== entry.name);
      filtered.unshift(entry); // most recent first
      const limited = filtered.slice(0, 8);
      try { localStorage.setItem('tillvalle_recent_purchases', JSON.stringify(limited)); } catch (e) { /* ignore */ }
    }

    function renderRecentPurchases() {
      const container = document.getElementById('recent-list');
      if (!container) return;
      const list = getRecentPurchases();
      container.innerHTML = '';
      if (!list.length) {
        container.innerHTML = '<div class="recent-empty">No recent purchases yet â€” buy something and it will appear here.</div>';
        return;
      }
      list.forEach(item => {
        const node = document.createElement('div');
        node.className = 'recent-item';
        node.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="recent-image">
          <div class="recent-name">${item.name}</div>
          <div class="recent-price">KES ${item.price} Ã— ${item.qty}</div>
          <button class="recent-buy-btn" data-name="${escapeHtmlAttr(item.name)}" data-image="${escapeHtmlAttr(item.image)}" data-price="${escapeHtmlAttr(item.price)}">Buy again</button>
        `;
        container.appendChild(node);
      });
    }

    // Utility escape for attribute insertion
    function escapeHtmlAttr(s) {
      if (s === undefined || s === null) return '';
      return String(s).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    // Handle buy-again clicks (delegated)
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.recent-buy-btn');
      if (!btn) return;
      const name = btn.dataset.name || '';
      const image = btn.dataset.image || '';
      const price = btn.dataset.price || '';
      openProductModal(name, '', image, price);
      // default to 1 quantity in modal
      const qtyInput = document.getElementById('quantity'); if (qtyInput) qtyInput.value = 1;
    });

    // render on load
    renderRecentPurchases();
    initCartDisplay();

    // Competitive E-commerce Features
    function quickAddToCart(name, price, image) {
      if (!localStorage.getItem('email')) {
        showToast('Please log in to add items to cart', true);
        setTimeout(() => window.location.href = 'login.html', 2000);
        return;
      }
      
      addToCart(name, price, image);
      trackRecentlyViewed({ name, price, image });
    }
    
    function trackRecentlyViewed(product) {
      let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
      recentlyViewed = recentlyViewed.filter(item => item.name !== product.name);
      recentlyViewed.unshift(product);
      recentlyViewed = recentlyViewed.slice(0, 5);
      localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
      renderRecentlyViewed();
    }
    
    function renderRecentlyViewed() {
      const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
      if (recentlyViewed.length === 0) return;
      
      let widget = document.getElementById('recently-viewed-widget');
      if (!widget) {
        widget = document.createElement('div');
        widget.id = 'recently-viewed-widget';
        widget.className = 'recently-viewed';
        document.body.appendChild(widget);
      }
      
      widget.innerHTML = `
        <h4>Recently Viewed</h4>
        <div class="recently-viewed-items">
          ${recentlyViewed.map(item => `
            <div class="recently-viewed-item" onclick="openProductModal('${item.name}', '', '${item.image}', ${item.price})">
              <img src="${item.image}" alt="${item.name}">
              <span>KES ${item.price}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // Make quickAddToCart global
    window.quickAddToCart = quickAddToCart;
    
    // Render recently viewed on load
    renderRecentlyViewed();

    // Fixed Search and Filter functionality
    const searchBar = document.getElementById('search-bar');
    const searchBtn = document.getElementById('search-btn');
    const priceFilter = document.getElementById('price-filter');

    function applyFilters() {
      const query = searchBar.value.trim().toLowerCase();
      const filterValue = priceFilter.value;
      const products = document.querySelectorAll('.product');
      
      products.forEach(product => {
        let show = true;
        
        // Search filter
        if (query) {
          const name = (product.dataset.name || product.querySelector('h4')?.textContent || '').toLowerCase();
          const description = (product.dataset.description || '').toLowerCase();
          show = name.includes(query) || description.includes(query);
        }
        
        // Price filter
        if (show && filterValue !== 'all') {
          const priceElement = product.querySelector('.price');
          const priceText = priceElement ? priceElement.dataset.price || product.dataset.price || '0' : '0';
          const price = parseInt(priceText);
          
          switch(filterValue) {
            case 'under-50':
              show = price < 50;
              break;
            case '50-100':
              show = price >= 50 && price <= 100;
              break;
            case '100-200':
              show = price >= 100 && price <= 200;
              break;
            case 'over-200':
              show = price > 200;
              break;
          }
        }
        
        product.style.display = show ? 'flex' : 'none';
      });
    }

    // Event listeners
    searchBtn.addEventListener('click', applyFilters);
    searchBar.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') applyFilters();
    });
    searchBar.addEventListener('input', applyFilters);
    priceFilter.addEventListener('change', applyFilters);

  // Toast notification
    function showToast(message, isError = false) {
      const toast = document.createElement('div');
      const bgColor = isError ? 'linear-gradient(135deg, #ff6b6b, #ee5a52)' : 'linear-gradient(135deg, #00b894, #00cec9)';
      toast.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: ${bgColor};
        color: white;
        padding: 15px 25px;
        border-radius: 50px;
        box-shadow: 0 8px 25px rgba(0,184,148,0.3);
        z-index: 999999;
        font-weight: 600;
        transform: translateY(100px);
        transition: all 0.3s ease;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.style.transform = 'translateY(0)', 100);
      setTimeout(() => {
        toast.style.transform = 'translateY(100px)';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }
  </script>

  <script>
    // Create overlay + buttons and toggle compact controls on shop cards
    (function(){
      try {
        document.querySelectorAll('.product').forEach(card => {
          if (card.querySelector('.add-toggle')) return;
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'add-toggle';
          btn.textContent = '+';
          btn.addEventListener('click', function(e){
            e.stopPropagation();
            const open = card.classList.toggle('controls-open');
            btn.textContent = open ? 'Ã—' : '+';
          });
          card.appendChild(btn);
        });
        document.addEventListener('click', function(e){
          document.querySelectorAll('.product.controls-open').forEach(c => {
            if (!c.contains(e.target)) {
              const t = c.querySelector('.add-toggle');
              if (t) t.textContent = '+';
              c.classList.remove('controls-open');
            }
          });
        });
      } catch(err) { /* no-op */ }
    })();
  </script>

  <script src="maintenance.js"></script>
  <script src="navbar-universal.js"></script>
  <script src="auth-cart.js"></script>
  <script src="shipping-widget.js"></script>
  <script src="cookie-widget.js"></script>
  <script src="script.js" defer></script>
  <script src="global-chat.js"></script>

  <!-- Structured data: ItemList of visible products for SEO -->
  <script>
    (function(){
      try {
        const products = Array.from(document.querySelectorAll('.product'));
        const itemList = products.map((prod, idx) => {
          const name = prod.dataset.name || (prod.querySelector('h4') && prod.querySelector('h4').textContent.trim()) || '';
          const img = prod.dataset.image || (prod.querySelector('img') && prod.querySelector('img').src) || '';
          const price = prod.dataset.price || (prod.querySelector('.price') && prod.querySelector('.price').dataset && prod.querySelector('.price').dataset.price) || '';
          const sku = (prod.dataset.sku) || name.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');
          return {
            "@type": "ListItem",
            position: idx + 1,
            item: {
              "@type": "Product",
              name: name,
              image: img,
              sku: sku,
              offers: {
                "@type": "Offer",
                priceCurrency: "KES",
                price: price ? String(price) : "0",
                availability: "http://schema.org/InStock"
              }
            }
          };
        });

        const ld = {
          "@context": "https://schema.org",
          "@type": "ItemList",
          itemListElement: itemList
        };

        const s = document.createElement('script');
        s.type = 'application/ld+json';
        s.text = JSON.stringify(ld);
        document.head.appendChild(s);
      } catch (e) {
        console.warn('structured data generation failed', e);
      }
    })();
  </script>
</body>
</html>
