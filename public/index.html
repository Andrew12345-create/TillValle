<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Fresh farm goods including eggs, butter, greens, and herbs delivered from Nancy & Jack's farm.">
  <link rel="icon" href="logo.jpg" type="image/jpeg">
  <title>TilleValle - Fresh Farm Goods</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="hero-styles.css">
  <link rel="stylesheet" href="enhanced-animations.css">
  <link rel="stylesheet" href="shop-styles.css">
  <link rel="stylesheet" href="chatbot.css">
  
  <!-- Open Graph meta tags -->
  <meta property="og:title" content="TilleValle - Fresh Farm Goods">
  <meta property="og:description" content="Fresh farm goods including eggs, butter, greens, and herbs delivered from Nancy & Jack's farm.">
  <meta property="og:image" content="images/logo.jpg">
  <meta property="og:url" content="https://yourdomain.com/index.html">
  
  <!-- Twitter meta tags -->
  <meta name="twitter:card" content="summary_large_image">

  <!-- Hotjar Tracking Code for Tillvalle -->
  <script>
      (function(h,o,t,j,a,r){
          h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
          h._hjSettings={hjid:6534945,hjsv:6};
          a=o.getElementsByTagName('head')[0];
          r=o.createElement('script');r.async=1;
          r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
          a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <img src="logo.jpg" alt="TilleValle" class="loading-logo">
    <div class="loading-spinner"></div>
  </div>
  <header>
    <nav class="navbar">
      <div class="nav-left">
        <a href="index.html" class="nav-link logo-link">
          <img src="logo.jpg" alt="TilleValle Logo" class="logo" />
        </a>
        <a href="shop.html" class="nav-link" data-translate="shop">Shop</a>
        <a href="about.html" class="nav-link" data-translate="about">About</a>
        <a href="contact.html" class="nav-link" data-translate="contact">Contact</a>
      </div>
      <div class="nav-right">
        <a href="cart.html" class="nav-link">ðŸ›’ <span data-translate="cart">Cart</span> (<span id="cart-count">0</span>)</a>
        <div id="user-area"></div>
      </div>
    </nav>
    <hr>
  </header>

  <main>
    <section class="hero">
      <h1>Welcome to <span>TillValle</span></h1>
      <p>Fresh eggs, butter, greens, and herbs â€” from our farms in Gilgil straight to your table.</p>
      <a href="shop.html" class="btn">Shop Now</a>
    </section>
    
    <!-- About Preview Section -->
    <section class="about-preview animated fadeIn">
      <a href="about.html"><h2 data-translate="aboutUs">About Us</h2></a>
      <p>
        TilleValle was founded by our dedicated team with a mission to deliver healthy, fresh, and organic farm products to families in Kenya. Our journey began when our visionary founders recognized a need for sustainable produce...
      </p>
      <a href="about.html" class="btn" data-translate="readMore">Read More</a>
    </section>

  </main>

  <footer>
    <p>&copy; 2025 TilleValle. All rights reserved.</p>
  </footer>

  <!-- Toast -->
  <div id="cart-toast"></div>

  <style>
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(45, 106, 79, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(45, 106, 79, 0); } 100% { box-shadow: 0 0 0 0 rgba(45, 106, 79, 0); } }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .max-chat-btn { position: fixed !important; bottom: 30px !important; right: 30px !important; width: 70px !important; height: 70px !important; background: linear-gradient(135deg, #2d6a4f, #1e4a36) !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; cursor: pointer !important; z-index: 10000 !important; color: white !important; font-size: 28px !important; box-shadow: 0 8px 25px rgba(45, 106, 79, 0.4) !important; animation: float 3s ease-in-out infinite, pulse 2s infinite !important; transition: all 0.3s ease !important; border: 3px solid rgba(255,255,255,0.2) !important; }
    .max-chat-btn:hover { transform: scale(1.1) translateY(-5px) !important; box-shadow: 0 15px 35px rgba(45, 106, 79, 0.6) !important; }
    .max-chat-panel { position: fixed !important; top: 0 !important; right: -450px !important; width: 420px !important; height: 100vh !important; background: linear-gradient(180deg, #ffffff 0%, #f8fffe 100%) !important; z-index: 9999 !important; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) !important; box-shadow: -10px 0 30px rgba(0,0,0,0.15) !important; border-left: 1px solid rgba(45, 106, 79, 0.1) !important; }
    .max-chat-panel.open { right: 0 !important; animation: slideIn 0.4s ease !important; }
    .max-chat-header { background: linear-gradient(135deg, #2d6a4f, #1e4a36) !important; color: white !important; padding: 25px !important; display: flex !important; justify-content: space-between !important; align-items: center !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important; }
    .max-chat-header h3 { margin: 0 !important; font-size: 20px !important; font-weight: 600 !important; }
    .max-chat-close { background: rgba(255,255,255,0.2) !important; border: none !important; color: white !important; font-size: 24px !important; cursor: pointer !important; width: 35px !important; height: 35px !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; transition: all 0.3s ease !important; }
    .max-chat-close:hover { background: rgba(255,255,255,0.3) !important; transform: rotate(90deg) !important; }
    .max-chat-messages { flex: 1 !important; overflow-y: auto !important; padding: 20px !important; background: linear-gradient(180deg, #ffffff 0%, #f8fffe 100%) !important; }
    .max-chat-input-area { padding: 20px !important; background: white !important; border-top: 1px solid rgba(45, 106, 79, 0.1) !important; box-shadow: 0 -2px 10px rgba(0,0,0,0.05) !important; position: relative !important; }
    .max-chat-input { width: 100% !important; padding: 15px !important; border: 2px solid rgba(45, 106, 79, 0.2) !important; border-radius: 25px !important; outline: none !important; font-size: 14px !important; transition: all 0.3s ease !important; background: rgba(248, 255, 254, 0.5) !important; }
    .max-chat-input:focus { border-color: #2d6a4f !important; box-shadow: 0 0 0 3px rgba(45, 106, 79, 0.1) !important; }
    .max-chat-send { position: absolute !important; right: 25px !important; top: 50% !important; transform: translateY(-50%) !important; background: linear-gradient(135deg, #2d6a4f, #1e4a36) !important; color: white !important; border: none !important; width: 45px !important; height: 45px !important; border-radius: 50% !important; cursor: pointer !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 16px !important; transition: all 0.3s ease !important; box-shadow: 0 2px 10px rgba(45, 106, 79, 0.3) !important; }
    .max-chat-send:hover { transform: translateY(-50%) scale(1.1) !important; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.5) !important; }
    .max-user-msg { text-align: right !important; margin: 15px 0 !important; animation: fadeIn 0.3s ease !important; }
    .max-user-msg span { background: linear-gradient(135deg, #2d6a4f, #1e4a36) !important; color: white !important; padding: 12px 18px !important; border-radius: 20px 20px 5px 20px !important; display: inline-block !important; max-width: 80% !important; box-shadow: 0 2px 10px rgba(45, 106, 79, 0.2) !important; }
    .max-bot-msg { margin: 15px 0 !important; animation: fadeIn 0.3s ease !important; }
    .max-bot-msg span { background: linear-gradient(135deg, #e8f5e8, #f0f9f0) !important; color: #2d6a4f !important; padding: 12px 18px !important; border-radius: 20px 20px 20px 5px !important; display: inline-block !important; max-width: 80% !important; border-left: 4px solid #2d6a4f !important; box-shadow: 0 2px 10px rgba(45, 106, 79, 0.1) !important; }
    .max-typing { display: flex !important; align-items: center !important; gap: 5px !important; color: #666 !important; font-style: italic !important; margin: 10px 0 !important; }
    .max-typing::after { content: '' !important; width: 8px !important; height: 8px !important; border-radius: 50% !important; background: #2d6a4f !important; animation: pulse 1.5s infinite !important; }
  </style>
  
  <div id="max-chatbot-btn" class="max-chat-btn" onclick="openMaxChat()">
    ðŸ’¬
  </div>
  
  <div id="max-chat-panel" class="max-chat-panel">
    <div class="max-chat-header">
      <h3>ðŸŒ± TillValle Assistant</h3>
      <button class="max-chat-close" onclick="closeMaxChat()">&times;</button>
    </div>
    <div id="max-chat-messages" class="max-chat-messages" style="display: flex; flex-direction: column; height: calc(100vh - 160px);">
      <div class="max-bot-msg">
        <span>ðŸ‘‹ Hello! I'm your TillValle assistant. I can help you with products, delivery, and orders. How can I assist you today?</span>
      </div>
    </div>
    <div class="max-chat-input-area">
      <input type="text" id="max-chat-input" class="max-chat-input" placeholder="Ask me anything about TillValle..." onkeypress="if(event.key=='Enter') sendMaxMessage()">
      <button class="max-chat-send" onclick="sendMaxMessage()">âž¤</button>
    </div>
  </div>
  
  <script>
    function openMaxChat() {
      document.getElementById('max-chat-panel').classList.add('open');
      document.getElementById('max-chatbot-btn').style.display = 'none';
      document.getElementById('max-chat-input').focus();
    }
    
    function closeMaxChat() {
      document.getElementById('max-chat-panel').classList.remove('open');
      setTimeout(function() {
        document.getElementById('max-chatbot-btn').style.display = 'flex';
      }, 200);
    }
    
    function addMaxTypingIndicator() {
      var messages = document.getElementById('max-chat-messages');
      var typing = document.createElement('div');
      typing.className = 'max-typing';
      typing.id = 'max-typing-indicator';
      typing.innerHTML = 'TillValle is typing';
      messages.appendChild(typing);
      messages.scrollTop = messages.scrollHeight;
    }
    
    function removeMaxTypingIndicator() {
      var typing = document.getElementById('max-typing-indicator');
      if (typing) typing.remove();
    }
    
    async function sendMaxMessage() {
      var input = document.getElementById('max-chat-input');
      var messages = document.getElementById('max-chat-messages');
      var message = input.value.trim();
      
      if (!message) return;
      
      var userDiv = document.createElement('div');
      userDiv.className = 'max-user-msg';
      userDiv.innerHTML = '<span>' + message + '</span>';
      messages.appendChild(userDiv);
      
      input.value = '';
      messages.scrollTop = messages.scrollHeight;
      
      addMaxTypingIndicator();
      
      try {
        var response = await fetch('/.netlify/functions/chatbot', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: message })
        });
        var data = await response.json();
        
        setTimeout(function() {
          removeMaxTypingIndicator();
          var botDiv = document.createElement('div');
          botDiv.className = 'max-bot-msg';
          botDiv.innerHTML = '<span>' + data.message + '</span>';
          messages.appendChild(botDiv);
          messages.scrollTop = messages.scrollHeight;
        }, 1000);
        
      } catch (error) {
        setTimeout(function() {
          removeMaxTypingIndicator();
          var errorDiv = document.createElement('div');
          errorDiv.className = 'max-bot-msg';
          errorDiv.innerHTML = '<span>ðŸ˜” Sorry, I am having trouble connecting. Please try again or contact us at support@tillvalle.com</span>';
          messages.appendChild(errorDiv);
          messages.scrollTop = messages.scrollHeight;
        }, 1000);
      }
    }
  </script>




  <script src="translations.js"></script>
  <script src="navbar-auth.js"></script>
  <script src="global-animations.js"></script>
  <script src="hero-script.js"></script>
  <script src="script.js" defer></script>
  <script>
    // Hide loading screen when page loads
    window.addEventListener('load', function() {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.classList.add('hidden');
        setTimeout(() => loadingScreen.remove(), 800);
      }
    });
    
    document.addEventListener('DOMContentLoaded', function() {
      const userEmail = localStorage.getItem('email');
      const userArea = document.getElementById('user-area');
      
      if (userEmail && userArea) {
        const initial = userEmail.charAt(0).toUpperCase();
        const profilePicture = localStorage.getItem(`profilePicture_${userEmail}`);
        const userDisplay = profilePicture ? 
          `<img src="${profilePicture}" alt="Profile" style="width:30px;height:30px;border-radius:50%;object-fit:cover;">` : 
          initial;
        let adminLink = '';
        if (userEmail === 'andrewmunamwangi@gmail.com') {
          adminLink = `<a href="admin.html" class="nav-link">Admin</a>`;
        }
        userArea.innerHTML = `
          <div class="user-dropdown-container">
            <span class="user-initial" onclick="toggleUserDropdown()" title="${userEmail}">${userDisplay}</span>
            <div class="user-dropdown" id="user-dropdown">
              <a href="profile.html">Profile</a>
              <a href="#" class="logout-btn" onclick="logout()">Logout</a>
            </div>
          </div>
          ${adminLink}
        `;
      } else if (userArea) {
        userArea.innerHTML = `<a href="login.html" class="nav-link">Login</a>`;
      }
      
      window.toggleUserDropdown = function() {
        const dropdown = document.getElementById('user-dropdown');
        if (dropdown) dropdown.classList.toggle('show');
      };
      
      window.logout = function() {
        localStorage.removeItem('email');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
      };
      
      document.addEventListener('click', (event) => {
        const dropdown = document.getElementById('user-dropdown');
        const container = document.querySelector('.user-dropdown-container');
        if (dropdown && container && !container.contains(event.target)) {
          dropdown.classList.remove('show');
        }
      });
      
      // Initialize cart counter
      function updateCartCounter() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCountElem = document.getElementById('cart-count');
        if (cartCountElem) cartCountElem.textContent = totalQuantity;
      }
      
      updateCartCounter();
      

    });
  </script>
</body>
</html>