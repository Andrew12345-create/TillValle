#!/bin/sh
# Pre-push hook that scrambles detected API keys before allowing the push
# Requires node to be available in PATH

echo "Running pre-push key scrubber..."

if command -v node >/dev/null 2>&1; then
  node scripts/scramble-keys.js
  rc=$?
  if [ $rc -eq 0 ]; then
    echo "Pre-push scrub completed (no keys or scrub commit created). Continuing push."
    exit 0
  else
    echo "Pre-push scrub failed or created changes. Please review and push again." >&2
    exit $rc
  fi
else
  echo "Node is not installed or not in PATH. Skipping key scrubber." >&2
  exit 0
fi
